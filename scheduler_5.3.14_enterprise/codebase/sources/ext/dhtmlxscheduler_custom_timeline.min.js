/*

@license
dhtmlxScheduler v.5.3.14 Professional

This software is covered by DHTMLX Enterprise License. Usage without proper license is prohibited.

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e._temp_matrix_scope=function(){var t=function(){var e,t={minMax:"[0;max]",maxMin:"[max;0]",nMaxMin:"[-max;0]"};function _(){var e=t.minMax,_=function(){var e=document.createElement("div");e.style.cssText="direction: rtl;overflow: auto;width:100px;height: 100px;position:absolute;top: -100500px;left: -100500px;";var t=document.createElement("div");return t.style.cssText="width: 100500px;height: 1px;",e.appendChild(t),e}();return document.body.appendChild(_),_.scrollLeft>0?e=t.minMax:(_.scrollLeft=-50,e=-50===_.scrollLeft?t.nMaxMin:t.maxMin),document.body.removeChild(_),e}function r(e,_){var r=i();return r===t.nMaxMin?e?-e:0:r===t.minMax?_-e:e}function i(){return e||(e=_()),e}return{modes:t,getMode:i,normalizeValue:r,getScrollValue:function(e){var t=getComputedStyle(e).direction;if(t&&"ltr"!==t){var _=e.scrollWidth-e.offsetWidth;return r(e.scrollLeft,_)}return e.scrollLeft},setScrollValue:function(e,t){var _=getComputedStyle(e).direction;if(_&&"ltr"!==_){var i=r(t,e.scrollWidth-e.offsetWidth);e.scrollLeft=i}else e.scrollLeft=t}}};function _(e,t){var _=t.order[e];return void 0===_&&(_="$_"+e),_}function r(e,t){if(t[e.key]=e,e.children)for(var _=0;_<e.children.length;_++)r(e.children[_],t)}function i(t,i){for(var a,n=[],l=0;l<i.y_unit.length;l++)n[l]=[];n[a]||(n[a]=[]);var s=function(e){for(var t={},_=e.y_unit_original||e.y_unit,i=0;i<_.length;i++)r(_[i],t);return t}(i),o="tree"==i.render;function d(e,t,_,r){e[t]||(e[t]=[]);for(var i=_;i<=r;i++)e[t][i]||(e[t][i]=[]),e[t][i].push(h)}o&&(n.$tree={});var c=i.y_property;for(l=0;l<t.length;l++){var h=t[l],m=h[c];a=_(m,i);var u=e._get_date_index(i,h.start_date),v=e._get_date_index(i,h.end_date);h.end_date.valueOf()==i._trace_x[v].valueOf()&&(v-=1),n[a]||(n[a]=[]),d(n,a,u,v);var f=s[m];if(o&&f&&f.$parent)for(var g={};f.$parent;){if(g[f.key])throw new Error("Invalid sections tree. Section `{key:'"+f.key+"', label:'"+f.label+"'}` has the same key as one of its parents. Make sure all sections have unique keys");g[f.key]=!0;var p=s[f.$parent];d(n.$tree,p.key,u,v),f=p}}return n}e.matrix={},e._merge=function(e,t){for(var _ in t)void 0===e[_]&&(e[_]=t[_])},e.createTimelineView=function(_){e._skin_init(),e._merge(_,{scrollHelper:t(),column_width:100,autoscroll:{range_x:200,range_y:100,speed_x:20,speed_y:10},_is_new_view:!0,_section_autowidth:!0,_x_scroll:0,_y_scroll:0,_h_cols:{},_label_rows:[],section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:e.xy.bar_height-5,event_min_dy:e.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(t,_,r){var i={};return e.checkEvent("onBeforeSectionRender")&&(i=e.callEvent("onBeforeSectionRender",[t,_,r])),i}}),_._original_x_start=_.x_start,"day"!=_.x_unit&&(_.first_hour=_.last_hour=0),_._start_correction=_.first_hour?60*_.first_hour*60*1e3:0,_._end_correction=_.last_hour?60*(24-_.last_hour)*60*1e3:0,e.checkEvent("onTimelineCreated")&&e.callEvent("onTimelineCreated",[_]),dhtmlxEventable(_);var r=e.render_data;e.render_data=function(t,i){if(this._mode!=_.name)return r.apply(this,arguments);if(i&&!_.show_unassigned&&"cell"!=_.render)for(var a=0;a<t.length;a++)this.clear_event(t[a]),this.render_timeline_event.call(this.matrix[this._mode],t[a],!0);else e._renderMatrix.call(_,!0,!0)},e.matrix[_.name]=_,e.templates[_.name+"_cell_value"]=function(e){return e?e.length:""},e.templates[_.name+"_cell_class"]=function(e){return""},e.templates[_.name+"_scalex_class"]=function(e){return""},e.templates[_.name+"_second_scalex_class"]=function(e){return""},e.templates[_.name+"_row_class"]=function(e,t){return t.folder_events_available&&e.children?"folder":""},e.templates[_.name+"_scaley_class"]=function(e,t,_){return""},e.templates[_.name+"_scale_label"]=function(e,t,_){return t},e.templates[_.name+"_tooltip"]=function(e,t,_){return _.text},e.templates[_.name+"_date"]=function(t,_){return t.getDay()==_.getDay()&&_-t<864e5||+t==+e.date.date_part(new Date(_))||+e.date.add(t,1,"day")==+_&&0===_.getHours()&&0===_.getMinutes()?e.templates.day_date(t):t.getDay()!=_.getDay()&&_-t<864e5?e.templates.day_date(t)+" &ndash; "+e.templates.day_date(_):e.templates.week_date(t,_)},e.templates[_.name+"_scale_date"]=e.date.date_to_str(_.x_date||e.config.hour_date),e.templates[_.name+"_second_scale_date"]=e.date.date_to_str(_.second_scale&&_.second_scale.x_date?_.second_scale.x_date:e.config.hour_date),e.date["add_"+_.name+"_private"]=function(t,r){var i=r,a=_.x_unit;if("minute"==_.x_unit||"hour"==_.x_unit){var n=i;"hour"==_.x_unit&&(n*=60),n%1440||(i=n/1440,a="day")}return e.date.add(t,i,a)},e.date["add_"+_.name]=function(t,r,i){var a=e.date["add_"+_.name+"_private"](t,(_.x_length||_.x_size)*_.x_step*r);if("minute"==_.x_unit||"hour"==_.x_unit){var n=_.x_length||_.x_size,l="hour"==_.x_unit?60*_.x_step:_.x_step;if(l*n%1440)if(+e.date.date_part(new Date(t))==+e.date.date_part(new Date(a)))_.x_start+=r*n;else{var s=1440/(n*l)-1,o=Math.round(s*n);_.x_start=r>0?_.x_start-o:o+_.x_start}}return a},e.date[_.name+"_start"]=function(t){var r=(e.date[_.x_unit+"_start"]||e.date.day_start).call(e.date,t),i=r.getTimezoneOffset(),a=(r=e.date.add(r,_.x_step*_.x_start,_.x_unit)).getTimezoneOffset();return i!=a&&r.setTime(r.getTime()+6e4*(a-i)),r},_._smartRenderingEnabled=function(){var t=null;(this.scrollable||this.smart_rendering)&&(t=e._timeline_smart_render.getViewPort(this.scrollHelper,this._sch_height));var _=!!t;return!!(this.scrollable?!1!==this.smart_rendering&&!!_:!!this.smart_rendering&&_)},_.scrollTo=e.bind(function(t){if(t){var _;_=t.date?t.date:t.left?t.left:t;var r,i=-1;if(t.section?i=this.posFromSection(t.section):t.top&&(i=t.top),r="number"==typeof _?_:this.posFromDate(_),e.config.rtl){var a=+e.$container.querySelector(".dhx_timeline_label_wrapper").style.height.replace("px",""),l=this._section_height[this.y_unit.length]+this._label_rows[this._label_rows.length-1].top;this.scrollHelper.getMode()==this.scrollHelper.modes.minMax&&(l>a||"tree"==this.render)&&(r-=n())}var s=e.$container.querySelector(".dhx_timeline_data_wrapper");this.scrollable||(s=e.$container.querySelector(".dhx_cal_data")),this.scrollable&&this.scrollHelper.setScrollValue(s,r),i>0&&(s.scrollTop=i)}},_),_.getScrollPosition=e.bind(function(){return{left:this._x_scroll||0,top:this._y_scroll||0}},_),_.posFromDate=e.bind(function(t){return e._timeline_getX({start_date:t},!1,this)-1},_),_.dateFromPos=function(t){return e._timeline_drag_date(_,t)},_.sectionFromPos=function(t){var r={y:t};return e._resolve_timeline_section(_,r),r.section},_.resolvePosition=function(e){var t={date:null,section:null};return e.left&&(t.date=_.dateFromPos(e.left)),e.top&&(t.section=_.sectionFromPos(e.top)),t},_.posFromSection=e.bind(function(e){var t=this.order[e];if(void 0===t)return-1;var _=0;for(var r in this.order)this.order[r]<t&&(_+=this._section_height[r]);return _},_),_.selectEvents=e.bind(function(t){var _=t.section,r=t.date,i=t.selectNested;return r?function(t,_,r,i){var a=e._timeline_smart_render.getPreparedEvents(i),n=[],l=[],s=i.order[t],o=i.y_unit[s];if(!o)return[];var d=e._get_date_index(i,_);return a.$matrix?(n=a.$matrix[s][d]||[],r&&a.$matrix.$tree&&a.$matrix.$tree[o.key]&&(l=a.$matrix.$tree[o.key][d]||[]),n.concat(l)):a[s]||[]}(_,r,i,this):_?function(t,_,r){var i=e._timeline_smart_render.getPreparedEvents(r),a=r.order[t],n=r.y_unit[a];if(!n)return[];var l=[t];_&&function e(t,_){_=_||[];if(t.children)for(var r=0;r<t.children.length;r++)_.push(t.children[r].key),e(t.children[r],_);return _}(n,l);for(var s=[],o=0;o<l.length;o++){var a=r.order[l[o]];if(void 0!==a&&i[a])s=s.concat(i[a]);else if(i.undefined)for(var d=0;d<i.undefined.length;d++){var c=i.undefined[d];c[r.y_property]==l[o]&&s.push(c)}}return s}(_,i,this):void 0},_),_.setRange=e.bind(function(t,_){var r=e.date[this.name+"_start"](new Date(t)),i=function(t,_,r){for(var i=0,a=e.date[r.name+"_start"](new Date(t)),n=r.x_step,l=r.x_unit;a<_;)i++,a=e.date.add(a,n,l);return i}(t,_,this);this.x_size=i,e.setCurrentView(r,this.name)},_),e.callEvent("onOptionsLoad",[_]),e[_.name+"_view"]=function(t){t?e._set_timeline_dates(_):e._renderMatrix.apply(_,arguments)};var i=new Date;e.date.add(i,_.x_step,_.x_unit).valueOf(),i.valueOf();e["mouse_"+_.name]=function(t){var r=this._drag_event;if(this._drag_id&&(r=this.getEvent(this._drag_id)),_.scrollable&&!t.converted){if(t.converted=1,t.x+=-_.dx+_._x_scroll,e.config.rtl){var i=+e.$container.querySelector(".dhx_timeline_label_wrapper").style.height.replace("px",""),a=_._section_height[_.y_unit.length]+_._label_rows[_._label_rows.length-1].top;t.x+=e.xy.scale_width,_.scrollHelper.getMode()==_.scrollHelper.modes.minMax&&(a>i||"tree"==_.render)&&(t.x+=n())}t.y+=_._y_scroll}else e.config.rtl?t.x-=_.dx-e.xy.scale_width:t.x-=_.dx;var l=e._timeline_drag_date(_,t.x);if(t.x=0,t.force_redraw=!0,t.custom=!0,"move"==this._drag_mode&&this._drag_id&&this._drag_event){r=this.getEvent(this._drag_id);var s=this._drag_event;if(t._ignores=this._ignores_detected||_._start_correction||_._end_correction,void 0===s._move_delta&&(s._move_delta=(r.start_date-l)/6e4,this.config.preserve_length&&t._ignores&&(s._move_delta=this._get_real_event_length(r.start_date,l,_),s._event_length=this._get_real_event_length(r.start_date,r.end_date,_))),this.config.preserve_length&&t._ignores){s._event_length;var o=this._get_fictional_event_length(l,s._move_delta,_,!0);l=new Date(l-o)}else l=e.date.add(l,s._move_delta,"minute")}if("resize"==this._drag_mode&&r&&(this.config.timeline_swap_resize&&this._drag_id&&(this._drag_from_start&&+l>+r.end_date?this._drag_from_start=!1:!this._drag_from_start&&+l<+r.start_date&&(this._drag_from_start=!0)),t.resize_from_start=this._drag_from_start,!this.config.timeline_swap_resize&&this._drag_id&&this._drag_from_start&&+l>=+e.date.add(r.end_date,-e.config.time_step,"minute")&&(l=e.date.add(r.end_date,-e.config.time_step,"minute"))),_.round_position)switch(this._drag_mode){case"move":this.config.preserve_length||(l=e._timeline_get_rounded_date.call(_,l,!1),"day"==_.x_unit&&(t.custom=!1));break;case"resize":this._drag_event&&(null!==this._drag_event._resize_from_start&&void 0!==this._drag_event._resize_from_start||(this._drag_event._resize_from_start=t.resize_from_start),t.resize_from_start=this._drag_event._resize_from_start,l=e._timeline_get_rounded_date.call(_,l,!this._drag_event._resize_from_start))}this._resolve_timeline_section(_,t),t.section&&this._update_timeline_section({pos:t,event:this.getEvent(this._drag_id),view:_}),t.y=Math.round((this._correct_shift(l,1)-this._min_date)/(6e4*this.config.time_step)),t.shift=this.config.time_step,_.round_position&&"new-size"==this._drag_mode&&l<=this._drag_start&&(t.shift=e.date.add(this._drag_start,_.x_step,_.x_unit)-this._drag_start);var d=this._is_pos_changed(this._drag_pos,t);return this._drag_pos&&d&&(this._drag_event._dhx_changed=!0),d||this._drag_pos.has_moved||(t.force_redraw=!1),t}},e._prepare_timeline_events=function(t){var _=[];if("cell"==t.render)_=e._timeline_trace_events.call(t);else{for(var r=e.get_visible_events(),i=t.order,a=0;a<r.length;a++){var n=r[a],l=n[t.y_property],s=t.order[l];t.y_unit[s];if(t.show_unassigned&&!l){for(var o in i)if(i.hasOwnProperty(o)){_[s=i[o]]||(_[s]=[]);var d=e._lame_copy({},n);d[t.y_property]=o,_[s].push(d);break}}else _[s]||(_[s]=[]),_[s].push(n)}_.$matrix=e._timeline_trace_events.call(t)}return _},e._populate_timeline_rendered=function(t){e._rendered=[];for(var _=t.querySelectorAll("div[event_id]"),r=0;r<_.length;r++)e._rendered.push(_[r])},e._get_timeline_event_height=function(e,t){var _=e[t.y_property],r=t.event_dy;return"full"==t.event_dy&&(r=t.section_autoheight?t._section_height[_]-6:t.dy-3),t.resize_events&&(r=Math.max(Math.floor(r/(e._count||1)),t.event_min_dy)),r},e._get_timeline_event_y=function(t,_){var r=t||0,i=2+r*_+(r?2*r:0);return e.config.cascade_event_display&&(i=2+r*e.config.cascade_event_margin+(r?2*r:0)),i},e.render_timeline_event=function(t,_){var r=t[this.y_property];if(!r)return"";var i=t._sorder,a=e._timeline_getX(t,!1,this),n=e._timeline_getX(t,!0,this),l=e._get_timeline_event_height(t,this),s=l-2;t._inner||"full"!=this.event_dy||(s=(s+2)*(t._count-i)-2),s+=3;var o=e._get_timeline_event_y(t._sorder,l),d=l+o+2;(!this._events_height[r]||this._events_height[r]<d)&&(this._events_height[r]=d);var c=e.templates.event_class(t.start_date,t.end_date,t);c="dhx_cal_event_line "+(c||""),e.getState().select_id==t.id&&(c+=" dhx_cal_event_selected"),t._no_drag_move&&(c+=" no_drag_move");var h=t.color?"background:"+t.color+";":"",m=t.textColor?"color:"+t.textColor+";":"",u=e.templates.event_bar_text(t.start_date,t.end_date,t),v="<div "+e._waiAria.eventBarAttrString(t)+" event_id='"+t.id+"' class='"+c+"' style='"+h+m+"position:absolute; top:"+o+"px; height: "+s+"px; "+(e.config.rtl?"right:":"left:")+a+"px; width:"+Math.max(0,n-a)+"px;"+(t._text_style||"")+"'>";if(e.config.drag_resize&&!e.config.readonly){var f=s+1,g="<div class='dhx_event_resize dhx_event_resize_start' style='height: "+f+"px;'></div>",p="<div class='dhx_event_resize dhx_event_resize_end' style='height: "+f+"px;'></div>";v+=(t._no_resize_start?"":g)+(t._no_resize_end?"":p)}if(v+=u+"</div>",!_)return v;var x=document.createElement("div");x.innerHTML=v;var y=this._scales[r];y&&(e._rendered.push(x.firstChild),y.appendChild(x.firstChild))};var a=function(e){return String(e).replace(/'/g,"&apos;").replace(/"/g,"&quot;")};function n(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var _=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return _==r&&(r=t.clientWidth),document.body.removeChild(t),_-r}function l(t){return e._helpers.formatDate(t)}function s(t,_){var r=t.querySelector(".dhx_timeline_data_wrapper");return _.scrollable||(r=e.$container.querySelector(".dhx_cal_data")),r}function o(){return e.$container.querySelector(".dhx_cal_data .dhx_timeline_label_col")}e._timeline_trace_events=function(){return i(e.get_visible_events(),this)},e._timeline_getX=function(t,_,r){var i=0,a=r._step,n=r.round_position,l=0,s=_?t.end_date:t.start_date;s.valueOf()>e._max_date.valueOf()&&(s=e._max_date);var o=s-e._min_date_timeline;if(o>0){var d=e._get_date_index(r,s);e._ignores[d]&&(n=!0);for(var c=0;c<d;c++)i+=e._cols[c];var h=e._timeline_get_rounded_date.apply(r,[s,!1]);n?+s>+h&&_&&(l=e._cols[d]):(o=s-h,r.first_hour||r.last_hour?((o-=r._start_correction)<0&&(o=0),(l=Math.round(o/a))>e._cols[d]&&(l=e._cols[d])):l=Math.round(o/a))}e._border_box_events();return i+=_?0===o||n?l-2:l:l+1},e._timeline_get_rounded_date=function(t,_){var r=e._get_date_index(this,t),i=this._trace_x[r];return _&&+t!=+this._trace_x[r]&&(i=this._trace_x[r+1]?this._trace_x[r+1]:e.date.add(this._trace_x[r],this.x_step,this.x_unit)),new Date(i)},e._timeline_skip_ignored=function(t){if(e._ignores_detected)for(var _,r,i,a,n=0;n<t.length;n++){for(a=t[n],i=!1,_=e._get_date_index(this,a.start_date),r=e._get_date_index(this,a.end_date);_<r;){if(!e._ignores[_]){i=!0;break}_++}i||_!=r||e._ignores[r]||+a.end_date>+this._trace_x[r]&&(i=!0),i||(t.splice(n,1),n--)}},e._timeline_calculate_event_positions=function(t){if(t&&"cell"!=this.render){e._timeline_skip_ignored.call(this,t),t.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var _=[],r=t.length,i=-1,a=null,n=0;n<r;n++){var l=t[n];l._inner=!1;var s=this.round_position?e._timeline_get_rounded_date.apply(this,[l.start_date,!1]):l.start_date;for(this.round_position?e._timeline_get_rounded_date.apply(this,[l.end_date,!0]):l.end_date;_.length;){if(!(_[_.length-1].end_date.valueOf()<=s.valueOf()))break;_.splice(_.length-1,1)}for(var o=!1,d=0;d<_.length;d++){var c=_[d];if(c.end_date.valueOf()<=s.valueOf()){o=!0,l._sorder=c._sorder,_.splice(d,1),l._inner=!0;break}}if(_.length&&(_[_.length-1]._inner=!0),!o)if(_.length)if(_.length<=_[_.length-1]._sorder){if(_[_.length-1]._sorder)for(var h=0;h<_.length;h++){for(var m=!1,u=0;u<_.length;u++)if(_[u]._sorder==h){m=!0;break}if(!m){l._sorder=h;break}}else l._sorder=0;l._inner=!0}else{for(var v=_[0]._sorder,f=1;f<_.length;f++)_[f]._sorder>v&&(v=_[f]._sorder);l._sorder=v+1,i<l._sorder&&(i=l._sorder,a=l),l._inner=!1}else l._sorder=0;_.push(l),_.length>(_.max_count||0)?(_.max_count=_.length,l._count=_.length):l._count=l._count?l._count:1}for(var g=0;g<t.length;g++)t[g]._count=_.max_count,e._register_copy&&e._register_copy(t[g]);(a||t[0])&&e.render_timeline_event.call(this,a||t[0],!1)}},e._timeline_get_events_html=function(t){var _="";if(t&&"cell"!=this.render)for(var r=0;r<t.length;r++)_+=e.render_timeline_event.call(this,t[r],!1);return _},e._timeline_update_events_html=function(t){var _="";if(t&&"cell"!=this.render){var r=e.getView(),i={},a=function(e,t){return e+"_"+t};t.forEach(function(e){i[a(e.id,e[r.y_property])]=!0}),e._rendered.forEach(function(e){if(e.parentNode){var t=e.parentNode.getAttribute("data-section-id");i[a(e.getAttribute("event_id"),t)]&&e.parentNode.removeChild(e)}});for(var n=0;n<t.length;n++)_+=e.render_timeline_event.call(this,t[n],!1)}return _},e._timeline_get_block_stats=function(t,_){var r={};return _._sch_height=t.offsetHeight,r.style_data_wrapper=(e.config.rtl?"padding-right:":"padding-left:")+_.dx+"px;",r.style_label_wrapper="width: "+_.dx+"px;",_.scrollable?(r.style_data_wrapper+="height:"+(_._sch_height-1)+"px;",void 0===_.html_scroll_width&&(_.html_scroll_width=n()),_._section_autowidth?_.custom_scroll_width=0:_.custom_scroll_width=_.html_scroll_width,r.style_label_wrapper+="height:"+(_._sch_height-1-_.custom_scroll_width)+"px;"):(r.style_data_wrapper+="height:"+(_._sch_height-1)+"px;",r.style_label_wrapper+="height:"+(_._sch_height-1)+"px;overflow:visible;"),r},e._timeline_get_cur_row_stats=function(t,_){var r=t._logic(t.render,t.y_unit[_],t);if(e._merge(r,{height:t.dy}),t.section_autoheight){var i=t.scrollable?t._sch_height-e.xy.scroll_width:t._sch_height;t.y_unit.length*r.height<i&&(r.height=Math.max(r.height,Math.floor((i-1)/t.y_unit.length)))}return t._section_height[t.y_unit[_].key]=r.height,r.td_className||(r.td_className="dhx_matrix_scell"+(e.templates[t.name+"_scaley_class"](t.y_unit[_].key,t.y_unit[_].label,t.y_unit[_])?" "+e.templates[t.name+"_scaley_class"](t.y_unit[_].key,t.y_unit[_].label,t.y_unit[_]):"")),r.td_content||(r.td_content=e.templates[t.name+"_scale_label"](t.y_unit[_].key,t.y_unit[_].label,t.y_unit[_])),e._merge(r,{tr_className:"",style_height:"height:"+r.height+"px;",style_width:"width:"+t.dx+"px;",summ_width:"width:"+t._summ+"px;",table_className:""}),r},e._timeline_get_fit_events_stats=function(e,t,_){if(e.fit_events){var r=e._events_height[e.y_unit[t].key]||0;_.height=r>_.height?r:_.height,_.style_height="height:"+_.height+"px;",_.style_line_height="line-height:"+(_.height-1)+"px;",e._section_height[e.y_unit[t].key]=_.height}return _.style_height="height:"+_.height+"px;",_.style_line_height="line-height:"+(_.height-1)+"px;",e._section_height[e.y_unit[t].key]=_.height,_},e._timeline_set_scroll_pos=function(e,t){var _=e.querySelector(".dhx_timeline_data_wrapper");_.scrollTop=t._y_scroll||0,t.scrollHelper.setScrollValue(_,t._x_scroll||0),t.scrollHelper.getMode()!=t.scrollHelper.modes.maxMin&&_.scrollLeft==t._summ-_.offsetWidth+t.dx&&(_.scrollLeft+=n())},e._timeline_save_scroll_pos=function(e,t,_,r){e._y_scroll=t||0,e._x_scroll=_||0},e._timeline_get_html_for_cell_data_row=function(e,t,_,r,i){var n="";return i.template&&(n+=" "+(i.template(i.section,i.view)||"")),"<div class='dhx_timeline_data_row"+n+"' data-section-id='"+a(r)+"' data-section-index='"+e+"' style='"+t.summ_width+t.style_height+" position:absolute; top:"+_+"px;'>"},e._timeline_get_html_for_cell_ignores=function(e){return'<div class="dhx_matrix_cell dhx_timeline_data_cell" style="'+e.style_height+e.style_line_height+';display:none"></div>'},e._timeline_get_html_for_cell=function(t,_,r,i,a,n){var s=r._trace_x[t],o=r.y_unit[_],d=e._cols[t],c=l(s),h=e.templates[r.name+"_cell_value"](i,s,o);return"<div data-col-id='"+t+"' data-col-date='"+c+"' class='dhx_matrix_cell dhx_timeline_data_cell "+e.templates[r.name+"_cell_class"](i,s,o)+"' style='width:"+d+"px;"+a.style_height+a.style_line_height+(e.config.rtl?" right:":"  left:")+n+"px;'><div style='width:auto'>"+h+"</div></div>"},e._timeline_get_html_for_bar_matrix_line=function(e,t,_,r){return"<div style='"+t.summ_width+" "+t.style_height+" position:absolute; top:"+_+"px;' data-section-id='"+a(r)+"' data-section-index='"+e+"' class='dhx_matrix_line'>"},e._timeline_get_html_for_bar_data_row=function(e,t){var _=e.table_className;return t.template&&(_+=" "+(t.template(t.section,t.view)||"")),"<div class='dhx_timeline_data_row "+_+"' style='"+e.summ_width+" "+e.style_height+"' >"},e._timeline_get_html_for_bar_ignores=function(){return""},e._timeline_get_html_for_bar=function(t,_,r,i,a,n){var s=l(r._trace_x[t]),o=r.y_unit[_],d="";r.cell_template&&(d=e.templates[r.name+"_cell_value"](i,r._trace_x[t],o,n));var c="line-height:"+r._section_height[o.key]+"px;";return"<div class='dhx_matrix_cell dhx_timeline_data_cell "+e.templates[r.name+"_cell_class"](i,r._trace_x[t],o,n)+"' style='width:"+e._cols[t]+"px; "+(e.config.rtl?"right:":"left:")+a+"px;'  data-col-id='"+t+"' data-col-date='"+s+"' ><div style='width:auto; height:100%;position:relative;"+c+"'>"+d+"</div></div>"},e._timeline_render_scale_header=function(t,_){var r=e.$container.querySelector(".dhx_timeline_scale_header");if(r&&r.parentNode.removeChild(r),_){r=document.createElement("div");var i="dhx_timeline_scale_header";t.second_scale&&(i+=" dhx_timeline_second_scale");var a=e.xy.scale_height;r.className=i,r.style.cssText=["width:"+(t.dx-1)+"px","height:"+a+"px","line-height:"+a+"px","top:"+(e.xy.nav_height+2)+"px",e.config.rtl?"right:0":"left:0"].join(";"),r.innerHTML=e.locale.labels[t.name+"_scale_header"]||"",e.$container.appendChild(r)}},e._timeline_y_scale=function(t){var _=e._timeline_get_block_stats(t,this),r=this.scrollable?" dhx_timeline_scrollable_data":"",i="<div class='dhx_timeline_table_wrapper'>",l="<div class='dhx_timeline_label_wrapper' style='"+_.style_label_wrapper+"'><div class='dhx_timeline_label_col'>",d="<div class='dhx_timeline_data_wrapper"+r+"' style='"+_.style_data_wrapper+"'><div class='dhx_timeline_data_col'>";e._load_mode&&e._load(),e._timeline_smart_render.clearPreparedEventsCache(c);var c=e._timeline_smart_render.getPreparedEvents(this);e._timeline_smart_render.cachePreparedEvents(c);for(var h=0,m=0;m<e._cols.length;m++)h+=e._cols[m];var u=new Date,v=e._cols.length-e._ignores_detected;u=(e.date.add(u,this.x_step*v,this.x_unit)-u-(this._start_correction+this._end_correction)*v)/h,this._step=u,this._summ=h;var f=e._colsS.heights=[],g=[];this._events_height={},this._section_height={},this._label_rows=[];var p=!1,x=0,y=null;(this.scrollable||this.smart_rendering)&&(y=e._timeline_smart_render.getViewPort(this.scrollHelper,this._sch_height)),e._timeline_smart_render._rendered_labels_cache=[],e._timeline_smart_render._rendered_events_cache=[];for(var w=!!y,b=this._smartRenderingEnabled(),k=[],E=0,S=0;S<this.y_unit.length;S++){e._timeline_calculate_event_positions.call(this,c[S]);var M=e._timeline_get_cur_row_stats(this,S);M=e._timeline_get_fit_events_stats(this,S,M),k.push(M),E+=M.height}y&&E<y.scrollTop&&(y.scrollTop=Math.max(0,E-y.height));for(S=0;S<this.y_unit.length;S++){M=k[S];var T=this.y_unit[S],C="<div class='dhx_timeline_label_row "+M.tr_className+"' style='top:"+x+"px;"+M.style_height+M.style_line_height+"'data-row-index='"+S+"' data-row-id='"+a(T.key)+"'><div class='"+M.td_className+"' style='"+M.style_width+" height:"+M.height+"px;' "+e._waiAria.label(M.td_content)+">"+M.td_content+"</div></div>";if(b&&this._label_rows.push({div:C,top:x,section:T}),b&&(e._timeline_smart_render.isInYViewPort({top:x,bottom:x+M.height},y)||(p=!0)),x+=M.height,p)p=!1;else{l+=C,b&&e._timeline_smart_render._rendered_labels_cache.push(S);var H={view:this,section:T,template:e.templates[this.name+"_row_class"]},D=0;if("cell"==this.render){d+=e._timeline_get_html_for_cell_data_row(S,M,x-M.height,T.key,H);for(var L=0;L<e._cols.length;L++)e._ignores[L]&&!b?d+=e._timeline_get_html_for_cell_ignores(M):b&&w?e._timeline_smart_render.isInXViewPort({left:D,right:D+e._cols[L]},y)&&(d+=e._timeline_get_html_for_cell(L,S,this,c[S][L],M,D)):d+=e._timeline_get_html_for_cell(L,S,this,c[S][L],M,D),D+=e._cols[L];d+="</div>"}else{d+=e._timeline_get_html_for_bar_matrix_line(S,M,x-M.height,T.key);var z=c[S];b&&w&&(z=e._timeline_smart_render.getVisibleEventsForRow(this,y,c,S)),d+=e._timeline_get_events_html.call(this,z),d+=e._timeline_get_html_for_bar_data_row(M,H);for(L=0;L<e._cols.length;L++)e._ignores[L]?d+=e._timeline_get_html_for_bar_ignores():b&&w?e._timeline_smart_render.isInXViewPort({left:D,right:D+e._cols[L]},y)&&(d+=e._timeline_get_html_for_bar(L,S,this,c[S],D)):d+=e._timeline_get_html_for_bar(L,S,this,c[S],D),D+=e._cols[L];d+="</div></div>"}}M.sectionKey=T.key,g.push(M)}(i+=l+"</div></div>",i+=d+"</div></div>",i+="</div>",this._matrix=c,t.innerHTML=i,b)&&(e.$container.querySelector(".dhx_timeline_data_col").style.height=x+"px");e._populate_timeline_rendered(t),this._scales={};m=0;for(var $=g.length;m<$;m++){f.push(g[m].height);var q=g[m].sectionKey;e._timeline_finalize_section_add(this,q,t)}b&&e._timeline_smart_render&&(e._timeline_smart_render._rendered_events_cache=[]),(b||this.scrollable)&&function(t,_,r,i){_._is_ev_creating=!1;var a=s(t,_),l=e._els.dhx_cal_header[0];function d(e){if(!(e=e||window.event).shiftKey){var t=e.deltaY||e.detail||-e.wheelDelta;t=t<0?-100:100,a.scrollTop+=t,e.preventDefault&&e.preventDefault()}}var c,h=t.querySelector(".dhx_timeline_label_wrapper");if(h&&(h.addEventListener?"onwheel"in document?h.addEventListener("wheel",d):"onmousewheel"in document&&h.addEventListener("mousewheel",d):h.attachEvent("onmousewheel",d),!h.$eventsAttached)){h.$eventsAttached=!0;var m={pageX:0,pageY:0};h.addEventListener("touchstart",function(e){var t=e;e.touches&&(t=e.touches[0]),m={pageX:t.pageX,pageY:t.pageY}}),h.addEventListener("touchmove",function(e){var t=e;e.touches&&(t=e.touches[0]);var _=m.pageY-t.pageY;m={pageX:t.pageX,pageY:t.pageY},_&&(a.scrollTop+=_),e&&e.preventDefault&&e.preventDefault()})}if(a.onscroll=function(d){var h=s(t,_),m=h.scrollTop,u=_.scrollHelper.getScrollValue(h),v=e._timeline_smart_render.getViewPort(_.scrollHelper,0,u,m),f=o();if(_.scrollable&&(f.style.top=-m+"px"),!1!==_.smart_rendering){if((u!==_._x_scroll||_._is_ev_creating)&&(_.second_scale?e._timeline_smart_render.updateHeader(_,v,l.children[1]):e._timeline_smart_render.updateHeader(_,v,l.children[0])),e.config.rtl){var g=+e.$container.querySelector(".dhx_timeline_label_wrapper").style.height.replace("px",""),p=_._section_height[_.y_unit.length]+_._label_rows[_._label_rows.length-1].top;_.scrollHelper.getMode()==_.scrollHelper.modes.minMax&&(p>g||"tree"==_.render)?l.style.right=-1-u-n()+"px":l.style.right=-1-u+"px",l.style.left="unset"}else l.style.left=-1-u+"px";(_._options_changed||m!==_._y_scroll||_._is_ev_creating)&&e._timeline_smart_render.updateLabels(_,v,f),_._is_ev_creating=!1,e._timeline_smart_render.updateGridCols(_,v),e._timeline_smart_render.updateGridRows(_,v);var x=!1;"cell"!=_.render&&(window.requestAnimationFrame?(x=!0,c&&cancelAnimationFrame(c),c=requestAnimationFrame(function(){_.name===e.getState().mode&&(e._timeline_smart_render.updateEvents(_,v),c=0,_.callEvent("onScroll",[_.scrollHelper.getScrollValue(a),a.scrollTop]))})):e._timeline_smart_render.updateEvents(_,v));var y,w=0;_._scales={};for(var b=0,k=(y="cell"===_.render?h.querySelectorAll(".dhx_timeline_data_col .dhx_timeline_data_row"):h.querySelectorAll(".dhx_timeline_data_col .dhx_matrix_line")).length;b<k;b++){var E=y[b].getAttribute("data-section-id"),S=_.order[E];r[S]=i[S].height,_._scales[E]=y[b]}for(b=0,k=r.length;b<k;b++)w+=r[b];e.$container.querySelector(".dhx_timeline_data_col").style.height=w+"px";var M=h.scrollTop,T=_.scrollHelper.getScrollValue(h),C=_._summ-e.$container.querySelector(".dhx_cal_data").offsetWidth+_.dx+_.custom_scroll_width;e._timeline_save_scroll_pos(_,M,T,C),x||_.callEvent("onScroll",[T,M]),_._is_new_view=!1}},!a.$eventsAttached){a.$eventsAttached=!0;var u={pageX:0,pageY:0};a.addEventListener("touchstart",function(e){var t=e;e.touches&&(t=e.touches[0]),u={pageX:t.pageX,pageY:t.pageY}}),a.addEventListener("touchmove",function(t){var r=t;t.touches&&(r=t.touches[0]);var i=o(),n=u.pageX-r.pageX,l=u.pageY-r.pageY;if(u={pageX:r.pageX,pageY:r.pageY},(n||l)&&!e.getState().drag_id){var s=Math.abs(n),d=Math.abs(l),c=Math.sqrt(n*n+l*l);s/c<.42?n=0:d/c<.42&&(l=0),_.scrollHelper.setScrollValue(a,_.scrollHelper.getScrollValue(a)+n),a.scrollTop+=l,_.scrollable&&l&&(i.style.top=-a.scrollTop+"px")}return t&&t.preventDefault&&t.preventDefault(),!1})}_.scroll_position&&_._is_new_view?_.scrollTo(_.scroll_position):e._timeline_set_scroll_pos(t,_),_._is_ev_creating=!0}(t,this,f,g)},e._timeline_finalize_section_add=function(t,_,r){var i=t._scales[_]=r.querySelector(".dhx_timeline_data_col [data-section-id='"+String(_).replace(/'/g,"\\'").replace(/"/g,'\\"')+"']");i&&e.callEvent("onScaleAdd",[i,_])},e.attachEvent("onBeforeViewChange",function(t,_,r,i){if(e.matrix[r]){var a=e.matrix[r];if(a.scrollable){if("tree"==a.render&&t===r&&_===i)return!0;a._x_scroll=a._y_scroll=0,e.$container.querySelector(".dhx_timeline_scrollable_data")&&e._timeline_set_scroll_pos(e._els.dhx_cal_data[0],a)}}return!0}),e._timeline_x_dates=function(t){var _=e._min_date,r=e._max_date;e._process_ignores(_,this.x_size,this.x_unit,this.x_step,t);this.x_size,t&&e._ignores_detected;for(var i=0,a=0;+_<+r;)if(this._trace_x[a]=new Date(_),"month"==this.x_unit&&e.date[this.x_unit+"_start"]&&(_=e.date[this.x_unit+"_start"](new Date(_))),_=e.date.add(_,this.x_step,this.x_unit),e.date[this.x_unit+"_start"]&&(_=e.date[this.x_unit+"_start"](_)),e._ignores[a]||i++,a++,t)if(i<this.x_size&&!(+_<+r))r=e.date["add_"+this.name+"_private"](r,(this.x_length||this.x_size)*this.x_step);else if(i>=this.x_size){e._max_date=_;break}return{total:a,displayed:i}},e._timeline_x_scale=function(t){var _=e.xy.scale_height,r=this._header_resized||e.xy.scale_height;e._cols=[],e._colsS={height:0},this._trace_x=[];var i=e.config.preserve_scale_length,a=e._timeline_x_dates.call(this,i),n=e._x-this.dx-e.xy.scroll_width;if(this.scrollable&&this.column_width>0){var s=this.column_width*a.displayed;s>n&&(n=s,this._section_autowidth=!1)}var o=[this.dx];e._els.dhx_cal_header[0].style.width=o[0]+n+"px";for(var d=e._min_date_timeline=e._min_date,c=a.displayed,h=a.total,m=0;m<h;m++)e._ignores[m]?(e._cols[m]=0,c++):e._cols[m]=Math.floor(n/(c-m)),n-=e._cols[m],o[m+1]=o[m]+e._cols[m];if(t.innerHTML="<div></div>",this.second_scale){for(var u=this.second_scale.x_unit,v=[this._trace_x[0]],f=[],g=[this.dx,this.dx],p=0,x=0;x<this._trace_x.length;x++){var y=this._trace_x[x];e._timeline_is_new_interval(u,y,v[p])&&(v[++p]=y,g[p+1]=g[p]);var w=p+1;f[p]=e._cols[x]+(f[p]||0),g[w]+=e._cols[x]}t.innerHTML="<div></div><div></div>";var b=t.firstChild;b.style.height=r+"px";var k=t.lastChild;k.style.position="relative",k.className="dhx_bottom_scale_container";for(var E=0;E<v.length;E++){var S=v[E],M=e.templates[this.name+"_second_scalex_class"](S),T=document.createElement("div");T.className="dhx_scale_bar dhx_second_scale_bar"+(M?" "+M:""),e.set_xy(T,f[E]-1,r-3,g[E],0),T.innerHTML=e.templates[this.name+"_second_scale_date"](S),b.appendChild(T)}}e.xy.scale_height=r,t=t.lastChild,this._h_cols={};for(var C=0;C<this._trace_x.length;C++)if(!e._ignores[C]){d=this._trace_x[C],e._render_x_header(C,o[C],d,t);var H=e.templates[this.name+"_scalex_class"](d);H&&(t.lastChild.className+=" "+H),t.lastChild.setAttribute("data-col-id",C),t.lastChild.setAttribute("data-col-date",l(d));var D=t.lastChild.cloneNode(!0);this._h_cols[C]={div:D,left:o[C]}}e.xy.scale_height=_;var L=this._trace_x;t.onclick=function(t){var _=e._timeline_locate_hcell(t);_&&e.callEvent("onXScaleClick",[_.x,L[_.x],t||event])},t.ondblclick=function(t){var _=e._timeline_locate_hcell(t);_&&e.callEvent("onXScaleDblClick",[_.x,L[_.x],t||event])}},e._timeline_is_new_interval=function(t,_,r){switch(t){case"hour":return _.getHours()!=r.getHours()||e._timeline_is_new_interval("day",_,r);case"day":return!(_.getDate()==r.getDate()&&_.getMonth()==r.getMonth()&&_.getFullYear()==r.getFullYear());case"week":return!(e.date.week_start(new Date(_)).valueOf()==e.date.week_start(new Date(r)).valueOf());case"month":return!(_.getMonth()==r.getMonth()&&_.getFullYear()==r.getFullYear());case"year":return!(_.getFullYear()==r.getFullYear());default:return!1}},e._timeline_reset_scale_height=function(t){if(this._header_resized&&(!t||!this.second_scale)){e.xy.scale_height/=2,this._header_resized=!1;var _=e._els.dhx_cal_header[0];_.className=_.className.replace(/ dhx_second_cal_header/gi,"")}},e._timeline_set_full_view=function(t){if(e._timeline_reset_scale_height.call(this,t),t){this.second_scale&&!this._header_resized&&(this._header_resized=e.xy.scale_height,e.xy.scale_height*=2,e._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),e.set_sizes(),e._init_matrix_tooltip();var _=e._min_date;if(e._timeline_x_scale.call(this,e._els.dhx_cal_header[0]),e.$container.querySelector(".dhx_timeline_scrollable_data")){var r=e._timeline_smart_render.getViewPort(this.scrollHelper),i=e._timeline_smart_render.getVisibleHeader(this,r);i&&(this.second_scale?e._els.dhx_cal_header[0].children[1].innerHTML=i:e._els.dhx_cal_header[0].children[0].innerHTML=i)}e._timeline_y_scale.call(this,e._els.dhx_cal_data[0]),e._min_date=_;var a=e._getNavDateElement();a&&(a.innerHTML=e.templates[this.name+"_date"](e._min_date,e._max_date)),e._mark_now&&e._mark_now(),e._timeline_reset_scale_height.call(this,t)}e._timeline_render_scale_header(this,t),e._timeline_hideToolTip()},e._timeline_hideToolTip=function(){e._tooltip&&(e._tooltip.style.display="none",e._tooltip.date="")},e._timeline_showToolTip=function(t,_,r){if("cell"==t.render){var i=_.x+"_"+_.y,a=t._matrix[_.y][_.x];if(!a)return e._timeline_hideToolTip();if(a.sort(function(e,t){return e.start_date>t.start_date?1:-1}),e._tooltip){if(e._tooltip.date==i)return;e._tooltip.innerHTML=""}else{var n=e._tooltip=document.createElement("div");n.className="dhx_year_tooltip",e.config.rtl&&(n.className+=" dhx_tooltip_rtl"),document.body.appendChild(n),n.onclick=e._click.dhx_cal_data}for(var l="",s=0;s<a.length;s++){var o=a[s].color?"background-color:"+a[s].color+";":"",d=a[s].textColor?"color:"+a[s].textColor+";":"";l+="<div class='dhx_tooltip_line' event_id='"+a[s].id+"' style='"+o+d+"'>",l+="<div class='dhx_tooltip_date'>"+(a[s]._timed?e.templates.event_date(a[s].start_date):"")+"</div>",l+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",l+=e.templates[t.name+"_tooltip"](a[s].start_date,a[s].end_date,a[s])+"</div>"}e._tooltip.style.display="",e._tooltip.style.top="0px",e.config.rtl&&r.left-e._tooltip.offsetWidth>=0||document.body.offsetWidth-_.src.offsetWidth-r.left-e._tooltip.offsetWidth<0?e._tooltip.style.left=r.left-e._tooltip.offsetWidth+"px":e._tooltip.style.left=r.left+_.src.offsetWidth+"px",e._tooltip.date=i,e._tooltip.innerHTML=l,document.body.offsetHeight-r.top-e._tooltip.offsetHeight<0?e._tooltip.style.top=r.top-e._tooltip.offsetHeight+_.src.offsetHeight+"px":e._tooltip.style.top=r.top+"px"}},e._matrix_tooltip_handler=function(t){var _=e.matrix[e._mode];if(_&&"cell"==_.render){if(_){var r=e._locate_cell_timeline(t);(t=t||event).target||t.srcElement;if(r)return e._timeline_showToolTip(_,r,e.$domHelpers.getOffset(r.src))}e._timeline_hideToolTip()}},e._init_matrix_tooltip=function(){e._detachDomEvent(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler),e.event(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler)},e._set_timeline_dates=function(t){e._min_date=e.date[t.name+"_start"](new Date(e._date)),e._max_date=e.date["add_"+t.name+"_private"](e._min_date,t.x_size*t.x_step),e.date[t.x_unit+"_start"]&&(e._max_date=e.date[t.x_unit+"_start"](e._max_date)),e._table_view=!0},e._renderMatrix=function(t,_){_||(e._els.dhx_cal_data[0].scrollTop=0),e._set_timeline_dates(this),e._timeline_set_full_view.call(this,t)},e._timeline_html_index=function(t){for(var _=t.parentNode.childNodes,r=-1,i=0;i<_.length;i++)if(_[i]==t){r=i;break}var a=r;if(e._ignores_detected)for(var n in e._ignores)e._ignores[n]&&1*n<=a&&a++;return a},e._timeline_locate_hcell=function(t){for(var _=(t=t||event).target?t.target:t.srcElement;_&&"DIV"!=_.tagName;)_=_.parentNode;if(_&&"DIV"==_.tagName&&"dhx_scale_bar"==e._getClassName(_).split(" ")[0])return{x:e._timeline_html_index(_),y:-1,src:_,scale:!0}},e._locate_cell_timeline=function(t){for(var _=(t=t||event).target?t.target:t.srcElement,r={},i=e.matrix[e._mode],a=e.getActionData(t),n=e._ignores,l=0,s=0;s<i._trace_x.length-1&&!(+a.date<i._trace_x[s+1]);s++)n[s]||l++;r.x=0===l?0:s,r.y=i.order[a.section];e._isRender("cell");var o=0;if(i.scrollable&&"cell"===i.render){if(!i._scales[a.section]||!i._scales[a.section].querySelector(".dhx_matrix_cell"))return;var d=i._scales[a.section].querySelector(".dhx_matrix_cell");if(!d)return;var c=d.offsetLeft;if(c>0){for(var h=e._timeline_drag_date(i,c),m=0;m<i._trace_x.length-1&&!(+h<i._trace_x[m+1]);m++);o=m}}r.src=i._scales[a.section]?i._scales[a.section].querySelectorAll(".dhx_matrix_cell")[s-o]:null;var u=!1,v=function(e,t){if(e.closest)return e.closest(t);if(e.matches||e.msMatchesSelector||e.webkitMatchesSelector){var _=e;if(!document.documentElement.contains(_))return null;do{if((_.matches||_.msMatchesSelector||_.webkitMatchesSelector).call(_,t))return _;_=_.parentElement||_.parentNode}while(null!==_&&1===_.nodeType);return null}return window.console.error("Your browser is not supported"),null}(_,".dhx_matrix_scell");return v&&(_=v,u=!0),u?(r.x=-1,r.src=_,r.scale=!0):r.x=s,r};var d=e._click.dhx_cal_data;e._click.dhx_marked_timespan=e._click.dhx_cal_data=function(t){var _=d.apply(this,arguments),r=e.matrix[e._mode];if(r){var i=e._locate_cell_timeline(t);i&&(i.scale?e.callEvent("onYScaleClick",[i.y,r.y_unit[i.y],t||event]):(e.callEvent("onCellClick",[i.x,i.y,r._trace_x[i.x],(r._matrix[i.y]||{})[i.x]||[],t||event]),e._timeline_set_scroll_pos(e._els.dhx_cal_data[0],r)))}return _},e.dblclick_dhx_matrix_cell=function(t){var _=e.matrix[e._mode];if(_){var r=e._locate_cell_timeline(t);r&&(r.scale?e.callEvent("onYScaleDblClick",[r.y,_.y_unit[r.y],t||event]):e.callEvent("onCellDblClick",[r.x,r.y,_._trace_x[r.x],(_._matrix[r.y]||{})[r.x]||[],t||event]))}};var c=e.dblclick_dhx_marked_timespan||function(){};e.dblclick_dhx_marked_timespan=function(t){return e.matrix[e._mode]?e.dblclick_dhx_matrix_cell(t):c.apply(this,arguments)},e.dblclick_dhx_matrix_scell=function(t){return e.dblclick_dhx_matrix_cell(t)},e._isRender=function(t){return e.matrix[e._mode]&&e.matrix[e._mode].render==t},e.attachEvent("onCellDblClick",function(t,_,r,i,a){if(!this.config.readonly&&("dblclick"!=a.type||this.config.dblclick_create)){var n=e.matrix[e._mode],l={};l.start_date=n._trace_x[t],l.end_date=n._trace_x[t+1]?n._trace_x[t+1]:e.date.add(n._trace_x[t],n.x_step,n.x_unit),n._start_correction&&(l.start_date=new Date(1*l.start_date+n._start_correction)),n._end_correction&&(l.end_date=new Date(l.end_date-n._end_correction)),l[n.y_property]=n.y_unit[_].key,e.addEventNow(l,null,a)}}),e.attachEvent("onBeforeDrag",function(t,_,r){return!e._isRender("cell")}),e.attachEvent("onEventChanged",function(e,t){t._timed=this.isOneDayEvent(t)}),e.attachEvent("onBeforeEventChanged",function(e,t,_,r){return e&&(e._move_delta=void 0),r&&(r._move_delta=void 0),!0}),e._is_column_visible=function(t){var _=e.matrix[e._mode],r=e._get_date_index(_,t);return!e._ignores[r]};var h=e._render_marked_timespan;e._render_marked_timespan=function(t,_,r,i,a){if(!e.config.display_marked_timespans)return[];if(e.matrix&&e.matrix[e._mode]){if(e._isRender("cell"))return;var n=e._lame_copy({},e.matrix[e._mode]);n.round_position=!1;var l=[],s=[],o=[],d=t.sections?t.sections.units||t.sections.timeline:null;if(r)o=[_],s=[r];else{var c=n.order;if(d)c.hasOwnProperty(d)&&(s.push(d),o.push(n._scales[d]));else if(n._scales)for(var m in c)c.hasOwnProperty(m)&&n._scales[m]&&(s.push(m),o.push(n._scales[m]))}i=i?new Date(i):e._min_date,a=a?new Date(a):e._max_date;if(i.valueOf()<e._min_date.valueOf()&&(i=new Date(e._min_date)),a.valueOf()>e._max_date.valueOf()&&(a=new Date(e._max_date)),!n._trace_x)return;for(var u=0;u<n._trace_x.length&&!e._is_column_visible(n._trace_x[u]);u++);if(u==n._trace_x.length)return;var v=[];if(t.days>6){var f=new Date(t.days);e.date.date_part(new Date(i))<=+f&&+a>=+f&&v.push(f)}else v.push.apply(v,e._get_dates_by_index(t.days));for(var g=t.zones,p=e._get_css_classes_by_config(t),x=0;x<s.length;x++){_=o[x],r=s[x];for(u=0;u<v.length;u++)for(var y=v[u],w=0;w<g.length;w+=2){var b=g[w],k=g[w+1],E=new Date(+y+60*b*1e3),S=new Date(+y+60*k*1e3);if(E=new Date(E.valueOf()+1e3*(E.getTimezoneOffset()-y.getTimezoneOffset())*60),i<(S=new Date(S.valueOf()+1e3*(S.getTimezoneOffset()-y.getTimezoneOffset())*60))&&a>E){var M=e._get_block_by_config(t);M.className=p;var T=e._timeline_getX({start_date:E},!1,n)-1,C=e._timeline_getX({start_date:S},!1,n)-1,H=Math.max(1,C-T-1),D=n._section_height[r]-1||n.dy-1;M.style.cssText="height: "+D+"px; "+(e.config.rtl?"right: ":"left: ")+T+"px; width: "+H+"px; top: 0;",_.insertBefore(M,_.firstChild),l.push(M)}}}return l}return h.apply(e,[t,_,r])};var m=e._append_mark_now;e._append_mark_now=function(t,_){if(e.matrix&&e.matrix[e._mode]){var r=e._currentDate(),i=e._get_zone_minutes(r),a={days:+e.date.date_part(r),zones:[i,i+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return e._render_marked_timespan(a)}return m.apply(e,[t,_])};var u=e._mark_timespans;e._mark_timespans=function(){if(e.matrix&&e.matrix[e.getState().mode]){for(var t=[],_=e.matrix[e.getState().mode],r=_.y_unit,i=0;i<r.length;i++){var a=r[i].key,n=_._scales[a],l=e._on_scale_add_marker(n,a);t.push.apply(t,l)}return t}return u.apply(this,arguments)};var v=e._on_scale_add_marker;e._on_scale_add_marker=function(t,_){if(e.matrix&&e.matrix[e._mode]){var r=[],i=e._marked_timespans;if(i&&e.matrix&&e.matrix[e._mode])for(var a=e._mode,n=e._min_date,l=e._max_date,s=i.global,o=e.date.date_part(new Date(n));o<l;o=e.date.add(o,1,"day")){var d=+o,c=o.getDay(),h=[],m=s[d]||s[c];if(h.push.apply(h,e._get_configs_to_render(m)),i[a]&&i[a][_]){var u=[],f=e._get_types_to_render(i[a][_][c],i[a][_][d]);u.push.apply(u,e._get_configs_to_render(f)),u.length&&(h=u)}for(var g=0;g<h.length;g++){var p=h[g],x=p.days;x<7?(x=d,r.push.apply(r,e._render_marked_timespan(p,t,_,o,e.date.add(o,1,"day"))),x=c):r.push.apply(r,e._render_marked_timespan(p,t,_,o,e.date.add(o,1,"day")))}}return r}return v.apply(this,arguments)},e._resolve_timeline_section=function(e,t){for(var _=0,r=0;_<this._colsS.heights.length&&!((r+=this._colsS.heights[_])>t.y);_++);e.y_unit[_]||(_=e.y_unit.length-1),this._drag_event&&!this._drag_event._orig_section&&(this._drag_event._orig_section=e.y_unit[_].key),t.fields={},_>=0&&e.y_unit[_]&&(t.section=t.fields[e.y_property]=e.y_unit[_].key)},e._update_timeline_section=function(e){var t=e.view,_=e.event,r=e.pos;if(_){if(_[t.y_property]!=r.section){var i=this._get_timeline_event_height(_,t);_._sorder=this._get_dnd_order(_._sorder,i,t._section_height[r.section])}_[t.y_property]=r.section}},e._get_date_index=function(e,t){for(var _=e._trace_x,r=0,i=_.length-1,a=t.valueOf();i-r>3;){var n=r+Math.floor((i-r)/2);_[n].valueOf()>a?i=n:r=n}for(var l=r;l<=i&&+t>=+_[l+1];)l++;return l},e._timeline_drag_date=function(t,_){var r=t,i=_;if(!r._trace_x.length)return new Date(e.getState().date);for(var a,n,l,s=0,o=0;o<=this._cols.length-1;o++)if((s+=n=this._cols[o])>i){a=(a=(i-(s-n))/n)<0?0:a;break}if(r.round_position){var d=1,c=e.getState().drag_mode;c&&"move"!=c&&"create"!=c&&(d=.5),a>=d&&o++,a=0}if(0===o&&this._ignores[0])for(o=1,a=0;this._ignores[o];)o++;else if(o==this._cols.length&&this._ignores[o-1]){for(o=this._cols.length-1,a=0;this._ignores[o];)o--;o++}if(o>=r._trace_x.length)l=e.date.add(r._trace_x[r._trace_x.length-1],r.x_step,r.x_unit),r._end_correction&&(l=new Date(l-r._end_correction));else{var h=a*n*r._step+r._start_correction;l=new Date(+r._trace_x[o]+h)}return l},e.attachEvent("onBeforeTodayDisplayed",function(){for(var t in e.matrix){var _=e.matrix[t];_.x_start=_._original_x_start}return!0}),e.attachEvent("onOptionsLoad",function(){for(var t in e.matrix){var _=e.matrix[t];_.order={},e.callEvent("onOptionsLoadStart",[]);for(t=0;t<_.y_unit.length;t++)_.order[_.y_unit[t].key]=t;e.callEvent("onOptionsLoadFinal",[]),e._date&&_.name==e._mode&&(_._options_changed=!0,e.setCurrentView(e._date,e._mode),setTimeout(function(){_._options_changed=!1}))}}),e.attachEvent("onEventIdChange",function(){var t=e.getView();t&&e.matrix[t.name]&&e._timeline_smart_render&&(e._timeline_smart_render.clearPreparedEventsCache(),e._timeline_smart_render.getPreparedEvents(t))}),e.attachEvent("onBeforeDrag",function(t,_,r){if("resize"==_){var i=r.target||r.srcElement;e._getClassName(i).indexOf("dhx_event_resize_end")<0?e._drag_from_start=!0:e._drag_from_start=!1}return!0});var f=10,g=null,p=null;function x(t){g&&clearInterval(g),e._schedulerOuter=e.$container.querySelector(".dhx_timeline_data_wrapper");var _={pageX:t.touches?t.touches[0].pageX:t.pageX,pageY:t.touches?t.touches[0].pageY:t.pageY};g=setInterval(function(){!function(t){if(!e.getState().drag_id)return clearInterval(g),void(p=null);var _=e.matrix[e._mode];if(!_)return;var r=e._schedulerOuter,i=function(t,_){var r=e.matrix[e._mode],i={},a={},n=_;for(i.x=t.touches?t.touches[0].pageX:t.pageX,i.y=t.touches?t.touches[0].pageY:t.pageY,a.left=n.offsetLeft+r.dx,a.top=n.offsetTop;n;)a.left+=n.offsetLeft,a.top+=n.offsetTop,n=n.offsetParent;return{x:i.x-a.left,y:i.y-a.top}}(t,r),a=r.offsetWidth-_.dx,n=r.offsetHeight,l=i.x,s=i.y,o=_.autoscroll||{};e._merge(o,{range_x:200,range_y:100,speed_x:20,speed_y:10});var d=y(l,a,p?p.x:0,o.range_x);_.scrollable||(d=0);var c=y(s,n,p?p.y:0,o.range_y);!c&&!d||p||(p={x:l,y:s},d=0,c=0);d*=o.speed_x,c*=o.speed_y,d&&c&&(Math.abs(d/5)>Math.abs(c)?c=0:Math.abs(c/5)>Math.abs(d)&&(d=0));d||c?(p.started=!0,function(t,_){var r=e._schedulerOuter;_&&(r.scrollTop+=_);t&&(r.scrollLeft+=t)}(d,c)):clearInterval(g)}(_)},f)}function y(e,t,_,r){return e<r&&(!p||p.started||e<_)?-1:t-e<r&&(!p||p.started||e>_)?1:0}var w=e.attachEvent("onSchedulerReady",function(){e.matrix&&(e.event(document.body,"mousemove",x),e.detachEvent(w))});e._timeline_smart_render={_prepared_events_cache:null,_rendered_events_cache:[],_rendered_header_cache:[],_rendered_labels_cache:[],_rows_to_delete:[],_rows_to_add:[],_cols_to_delete:[],_cols_to_add:[],getViewPort:function(t,_,r,i){var a=e.$container.querySelector(".dhx_cal_data"),n=a.getBoundingClientRect(),l=e.$container.querySelector(".dhx_timeline_scrollable_data");l&&void 0===r&&(r=t.getScrollValue(l)),void 0===i&&(i=l?l.scrollTop:a.scrollTop);var s={};for(var o in n)s[o]=n[o];return s.scrollLeft=r||0,s.scrollTop=i||0,_&&(n.height=_),s},isInXViewPort:function(e,t){var _=t.scrollLeft,r=t.width+t.scrollLeft;return e.left<r+100&&e.right>_-100},isInYViewPort:function(e,t){var _=t.scrollTop,r=t.height+t.scrollTop;return e.top<r+100&&e.bottom>_-100},getVisibleHeader:function(t,_){var r="";for(var i in this._rendered_header_cache=[],t._h_cols){var a=t._h_cols[i];if(this.isInXViewPort({left:a.left,right:a.left+e._cols[i]},_))r+=a.div.outerHTML,this._rendered_header_cache.push(a.div.getAttribute("data-col-id"))}return r},updateHeader:function(t,_,r){this._cols_to_delete=[],this._cols_to_add=[];for(var i=e.$container.querySelectorAll(".dhx_cal_header > div"),a=i[i.length-1].querySelectorAll(".dhx_scale_bar"),n=[],l=0;l<a.length;l++)n.push(a[l].getAttribute("data-col-id"));if(this.getVisibleHeader(t,_)){for(var s=this._rendered_header_cache.slice(),o=[],d=(l=0,n.length);l<d;l++){var c=s.indexOf(n[l]);c>-1?s.splice(c,1):o.push(n[l])}o.length&&(this._cols_to_delete=o.slice(),this._deleteHeaderCells(o,t,r)),s.length&&(this._cols_to_add=s.slice(),this._addHeaderCells(s,t,r))}},_deleteHeaderCells:function(e,t,_){for(var r=0;r<e.length;r++){var i=_.querySelector('[data-col-id="'+e[r]+'"]');i&&_.removeChild(i)}},_addHeaderCells:function(e,t,_){for(var r="",i=0;i<e.length;i++)r+=t._h_cols[e[i]].div.outerHTML;_.insertAdjacentHTML("beforeEnd",r)},getVisibleLabels:function(e,t){if(e._label_rows.length){var _="";this._rendered_labels_cache=[];for(var r=0;r<e._label_rows.length;r++){if(this.isInYViewPort({top:e._label_rows[r].top,bottom:e._label_rows[r].top+e._section_height[e.y_unit[r].key]},t))_+=e._label_rows[r].div,this._rendered_labels_cache.push(r)}return _}},updateLabels:function(e,t,_){this._rows_to_delete=[],this._rows_to_add=[];var r=this._rendered_labels_cache.slice();if(r.length||(this.getVisibleLabels(e,t),r=this._rendered_labels_cache.slice()),this.getVisibleLabels(e,t)){for(var i=this._rendered_labels_cache.slice(),a=[],n=0,l=r.length;n<l;n++){var s=i.indexOf(r[n]);s>-1?i.splice(s,1):a.push(r[n])}a.length&&(this._rows_to_delete=a.slice(),this._deleteLabelCells(a,e,_)),i.length&&(this._rows_to_add=i.slice(),this._addLabelCells(i,e,_))}},_deleteLabelCells:function(e,t,_){for(var r=0;r<e.length;r++){var i=_.querySelector('[data-row-index="'+e[r]+'"]');i&&_.removeChild(i)}},_addLabelCells:function(e,t,_){for(var r="",i=0;i<e.length;i++)r+=t._label_rows[e[i]].div;_.insertAdjacentHTML("beforeEnd",r)},clearPreparedEventsCache:function(){this.cachePreparedEvents(null)},cachePreparedEvents:function(e){this._prepared_events_cache=e,this._prepared_events_coordinate_cache=e},getPreparedEvents:function(t){var _;return this._prepared_events_cache?_=this._prepared_events_cache:((_=e._prepare_timeline_events(t)).$coordinates={},this.cachePreparedEvents(_)),_},updateEvents:function(t,_){var r=this.getPreparedEvents(t),i=this._rendered_events_cache.slice();this._rendered_events_cache=[];var a=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(a){for(var n=0;n<this._rendered_labels_cache.length;n++){var l=this._rendered_labels_cache[n],s=[],o=i[l]?i[l].slice():[];e._timeline_calculate_event_positions.call(t,r[l]);for(var d=e._timeline_smart_render.getVisibleEventsForRow(t,_,r,l),c=0,h=d.length;c<h;c++){var m=o.indexOf(d[c].id);m>-1?o.splice(m,1):s.push(d[c])}var u=a.querySelector('[data-section-index="'+l+'"]');o.length&&this._deleteEvents(o,t,u),s.length&&this._addEvents(s,t,u,l)}e._populate_timeline_rendered(e.$container),t._matrix=r}},_deleteEvents:function(e,t,_){for(var r=0;r<e.length;r++){var i=_.querySelector('[event_id="'+e[r]+'"]');i&&(i.classList.contains("dhx_in_move")||_.removeChild(i))}},_addEvents:function(t,_,r,i){var a=e._timeline_update_events_html.call(_,t);r.insertAdjacentHTML("beforeEnd",a)},getVisibleEventsForRow:function(t,_,r,i){var a=[];if("cell"==t.render)a=r;else{var n=r[i];if(n)for(var l=0,s=n.length;l<s;l++){var o,d,c=n[l],h=i+"_"+c.id;r.$coordinates&&r.$coordinates[h]?(o=r.$coordinates[h].xStart,d=r.$coordinates[h].xEnd):(o=e._timeline_getX(c,!1,t),d=e._timeline_getX(c,!0,t),r.$coordinates&&(r.$coordinates[h]={xStart:o,xEnd:d})),e._timeline_smart_render.isInXViewPort({left:o,right:d},_)&&(a.push(c),this._rendered_events_cache[i]||(this._rendered_events_cache[i]=[]),this._rendered_events_cache[i].push(c.id))}}return a},getVisibleRowCellsHTML:function(t,_,r,i,a){for(var n,l="",s=this._rendered_header_cache,o=0;o<s.length;o++){var d=s[o];n=t._h_cols[d].left-t.dx,e._ignores[d]?"cell"==t.render?l+=e._timeline_get_html_for_cell_ignores(r):l+=e._timeline_get_html_for_bar_ignores():"cell"==t.render?l+=e._timeline_get_html_for_cell(d,a,t,i[a][d],r,n):l+=e._timeline_get_html_for_bar(d,a,t,i[a],n)}return l},getVisibleTimelineRowsHTML:function(t,_,r,i){var a="",n=e._timeline_get_cur_row_stats(t,i);n=e._timeline_get_fit_events_stats(t,i,n);var l=t._label_rows[i],s=e.templates[t.name+"_row_class"],o={view:t,section:l.section,template:s};return"cell"==t.render?(a+=e._timeline_get_html_for_cell_data_row(i,n,l.top,l.section.key,o),a+=this.getVisibleRowCellsHTML(t,_,n,r,i),a+="</div>"):(a+=e._timeline_get_html_for_bar_matrix_line(i,n,l.top,l.section.key,o),a+=e._timeline_get_html_for_bar_data_row(n,o),a+=this.getVisibleRowCellsHTML(t,_,n,r,i),a+="</div></div>"),a},updateGridRows:function(e,t){this._rows_to_delete.length&&this._deleteGridRows(this._rows_to_delete),this._rows_to_add.length&&this._addGridRows(this._rows_to_add,e,t)},_deleteGridRows:function(t){var _=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(_){for(var r=0;r<t.length;r++){var i=_.querySelector('[data-section-index="'+t[r]+'"]');_.removeChild(i)}this._rows_to_delete=[]}},_addGridRows:function(t,_,r){var i=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(i){for(var a=this.getPreparedEvents(_),n="",l=0;l<t.length;l++)n+=this.getVisibleTimelineRowsHTML(_,r,a,t[l]);i.insertAdjacentHTML("beforeEnd",n);for(l=0;l<t.length;l++)e._timeline_finalize_section_add(_,_.y_unit[t[l]].key,i);e._mark_now&&e._mark_now(),this._rows_to_add=[]}},updateGridCols:function(t,_){for(var r=this._rendered_header_cache,i={},a={},n=0;n<r.length;n++)a[r[n]]=!0;var l=e.$container.querySelector(".dhx_timeline_data_row");if(l){var s=l.querySelectorAll("[data-col-id]");for(n=0;n<s.length;n++)i[s[n].getAttribute("data-col-id")]=!0}var o=[],d=[];for(var n in i)a[n]||o.push(n);for(var n in a)i[n]||d.push(n);o.length&&this._deleteGridCols(o,t),d.length&&this._addGridCols(d,t,_)},_deleteGridCols:function(t,_){var r=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(r){for(var i=0;i<this._rendered_labels_cache.length;i++){var a;if(a="cell"==_.render?r.querySelector('[data-section-index="'+this._rendered_labels_cache[i]+'"]'):r.querySelector('[data-section-index="'+this._rendered_labels_cache[i]+'"] .dhx_timeline_data_row '))for(var n=0;n<t.length;n++){var l=a.querySelector('[data-col-id="'+t[n]+'"]');l&&a.removeChild(l)}}this._cols_to_delete=[]}},_addGridCols:function(t,_,r){var i=e.$container.querySelector(".dhx_cal_data .dhx_timeline_data_col");if(i){for(var a=this.getPreparedEvents(_),n=0;n<this._rendered_labels_cache.length;n++){var l,s=this._rendered_labels_cache[n],o="",d=e._timeline_get_cur_row_stats(_,s);if(d=e._timeline_get_fit_events_stats(_,s,d),l="cell"==_.render?i.querySelector('[data-section-index="'+s+'"]'):i.querySelector('[data-section-index="'+s+'"] .dhx_timeline_data_row')){for(var c=0;c<t.length;c++){if(!l.querySelector('[data-col-id="'+t[c]+'"]')){var h=this.getVisibleGridCell(_,r,d,a,s,t[c]);h&&(o+=h)}}l.insertAdjacentHTML("beforeEnd",o)}}this._cols_to_add=[]}},getVisibleGridCell:function(t,_,r,i,a,n){if(t._h_cols[n]){var l="",s=t._h_cols[n].left-t.dx;return"cell"==t.render?e._ignores[n]||(l+=e._timeline_get_html_for_cell(n,a,t,i[a][n],r,s)):e._ignores[n]||(l+=e._timeline_get_html_for_bar(n,a,t,i[a],s)),l}}}},e._temp_matrix_scope()});