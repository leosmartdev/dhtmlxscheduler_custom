/*
@license
dhtmlxScheduler v.4.4.9 Professional

This software is covered by DHTMLX Enterprise License. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
Scheduler.plugin(function(e){e._temp_matrix_scope=function(){e.matrix={},e._merge=function(e,t){for(var _ in t)void 0===e[_]&&(e[_]=t[_])},e.createTimelineView=function(t){e._skin_init(),e._merge(t,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:e.xy.bar_height-5,event_min_dy:e.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(t,_,i){var a={};return e.checkEvent("onBeforeSectionRender")&&(a=e.callEvent("onBeforeSectionRender",[t,_,i])),a}}),t._original_x_start=t.x_start,"day"!=t.x_unit&&(t.first_hour=t.last_hour=0),t._start_correction=t.first_hour?60*t.first_hour*60*1e3:0,t._end_correction=t.last_hour?60*(24-t.last_hour)*60*1e3:0,e.checkEvent("onTimelineCreated")&&e.callEvent("onTimelineCreated",[t]);var _=e.render_data;e.render_data=function(i,a){if(this._mode!=t.name)return _.apply(this,arguments);if(a&&!t.show_unassigned&&"cell"!=t.render)for(var r=0;r<i.length;r++)this.clear_event(i[r]),this.render_timeline_event.call(this.matrix[this._mode],i[r],!0);else e._renderMatrix.call(t,!0,!0)},e.matrix[t.name]=t,e.templates[t.name+"_cell_value"]=function(e){return e?e.length:""},e.templates[t.name+"_cell_class"]=function(e){return""},e.templates[t.name+"_scalex_class"]=function(e){return""},e.templates[t.name+"_second_scalex_class"]=function(e){return""},e.templates[t.name+"_scaley_class"]=function(e,t,_){return""},e.templates[t.name+"_scale_label"]=function(e,t,_){return t},e.templates[t.name+"_tooltip"]=function(e,t,_){return _.text},e.templates[t.name+"_date"]=function(t,_){return t.getDay()==_.getDay()&&_-t<864e5||+t==+e.date.date_part(new Date(_))||+e.date.add(t,1,"day")==+_&&0===_.getHours()&&0===_.getMinutes()?e.templates.day_date(t):t.getDay()!=_.getDay()&&_-t<864e5?e.templates.day_date(t)+" &ndash; "+e.templates.day_date(_):e.templates.week_date(t,_)},e.templates[t.name+"_scale_date"]=e.date.date_to_str(t.x_date||e.config.hour_date),e.templates[t.name+"_second_scale_date"]=e.date.date_to_str(t.second_scale&&t.second_scale.x_date?t.second_scale.x_date:e.config.hour_date),e.date["add_"+t.name+"_private"]=function(_,i){var a=i,r=t.x_unit;if("minute"==t.x_unit||"hour"==t.x_unit){var n=a;"hour"==t.x_unit&&(n*=60),n%1440||(a=n/1440,r="day")}return e.date.add(_,a,r)},e.date["add_"+t.name]=function(_,i,a){var r=e.date["add_"+t.name+"_private"](_,(t.x_length||t.x_size)*t.x_step*i);if("minute"==t.x_unit||"hour"==t.x_unit){var n=t.x_length||t.x_size,s="hour"==t.x_unit?60*t.x_step:t.x_step;if(s*n%1440)if(+e.date.date_part(new Date(_))==+e.date.date_part(new Date(r)))t.x_start+=i*n;else{var l=1440/(n*s)-1,d=Math.round(l*n);t.x_start=i>0?t.x_start-d:d+t.x_start}}return r},e.date[t.name+"_start"]=function(_){var i=(e.date[t.x_unit+"_start"]||e.date.day_start).call(e.date,_),a=i.getTimezoneOffset(),r=(i=e.date.add(i,t.x_step*t.x_start,t.x_unit)).getTimezoneOffset();return a!=r&&i.setTime(i.getTime()+6e4*(r-a)),i},e.callEvent("onOptionsLoad",[t]),e[t.name+"_view"]=function(_){_?e._set_timeline_dates(t):e._renderMatrix.apply(t,arguments)};var i=new Date;e.date.add(i,t.x_step,t.x_unit).valueOf(),i.valueOf();e["mouse_"+t.name]=function(_){var i=this._drag_event;this._drag_id&&(i=this.getEvent(this._drag_id)),_.x-=t.dx;var a=e._timeline_drag_date(t,_.x);if(_.x=0,_.force_redraw=!0,_.custom=!0,"move"==this._drag_mode&&this._drag_id&&this._drag_event){i=this.getEvent(this._drag_id);var r=this._drag_event;if(_._ignores=this._ignores_detected||t._start_correction||t._end_correction,void 0===r._move_delta&&(r._move_delta=(i.start_date-a)/6e4,this.config.preserve_length&&_._ignores&&(r._move_delta=this._get_real_event_length(i.start_date,a,t),r._event_length=this._get_real_event_length(i.start_date,i.end_date,t))),this.config.preserve_length&&_._ignores){r._event_length;var n=this._get_fictional_event_length(a,r._move_delta,t,!0);a=new Date(a-n)}else a=e.date.add(a,r._move_delta,"minute")}if("resize"==this._drag_mode&&i&&(this.config.timeline_swap_resize&&this._drag_id&&(this._drag_from_start&&+a>+i.end_date?this._drag_from_start=!1:!this._drag_from_start&&+a<+i.start_date&&(this._drag_from_start=!0)),_.resize_from_start=this._drag_from_start,!this.config.timeline_swap_resize&&this._drag_id&&this._drag_from_start&&+a>=+e.date.add(i.end_date,-e.config.time_step,"minute")&&(a=e.date.add(i.end_date,-e.config.time_step,"minute"))),t.round_position)switch(this._drag_mode){case"move":this.config.preserve_length||(a=e._timeline_get_rounded_date.call(t,a,!1),"day"==t.x_unit&&(_.custom=!1));break;case"resize":this._drag_event&&(null!==this._drag_event._resize_from_start&&void 0!==this._drag_event._resize_from_start||(this._drag_event._resize_from_start=_.resize_from_start),_.resize_from_start=this._drag_event._resize_from_start,a=e._timeline_get_rounded_date.call(t,a,!this._drag_event._resize_from_start))}this._resolve_timeline_section(t,_),_.section&&this._update_timeline_section({pos:_,event:this.getEvent(this._drag_id),view:t}),_.y=Math.round((this._correct_shift(a,1)-this._min_date)/(6e4*this.config.time_step)),_.shift=this.config.time_step,t.round_position&&"new-size"==this._drag_mode&&a<=this._drag_start&&(_.shift=e.date.add(this._drag_start,t.x_step,t.x_unit)-this._drag_start);var s=this._is_pos_changed(this._drag_pos,_);return this._drag_pos&&s&&(this._drag_event._dhx_changed=!0),s||this._drag_pos.has_moved||(_.force_redraw=!1),_}},e._prepare_timeline_events=function(t){var _=[];if("cell"==t.render)_=e._timeline_trace_events.call(t);else for(var i=e.get_visible_events(),a=t.order,r=0;r<i.length;r++){var n=i[r],s=n[t.y_property],l=t.order[s];if(t.show_unassigned&&!s){for(var d in a)if(a.hasOwnProperty(d)){_[l=a[d]]||(_[l]=[]);var o=e._lame_copy({},n);o[t.y_property]=d,_[l].push(o)}}else _[l]||(_[l]=[]),_[l].push(n)}return _},e._populate_timeline_rendered=function(t){e._rendered=[];for(var _=t.getElementsByTagName("DIV"),i=0;i<_.length;i++)_[i].getAttribute("event_id")&&e._rendered.push(_[i])},e._get_timeline_event_height=function(e,t){var _=e[t.y_property],i=t.event_dy;return"full"==t.event_dy&&(i=t.section_autoheight?t._section_height[_]-6:t.dy-3),t.resize_events&&(i=Math.max(Math.floor(i/e._count),t.event_min_dy)),i},e._get_timeline_event_y=function(t,_){var i=t,a=2+i*_+(i?2*i:0);return e.config.cascade_event_display&&(a=2+i*e.config.cascade_event_margin+(i?2*i:0)),a},e.render_timeline_event=function(t,_){var i=t[this.y_property];if(!i)return"";var a=t._sorder,r=e._timeline_getX(t,!1,this),n=e._timeline_getX(t,!0,this),s=e._get_timeline_event_height(t,this),l=s-2;t._inner||"full"!=this.event_dy||(l=(l+2)*(t._count-a)-2);var d=e._get_timeline_event_y(t._sorder,s),o=s+d+2;(!this._events_height[i]||this._events_height[i]<o)&&(this._events_height[i]=o);var h=e.templates.event_class(t.start_date,t.end_date,t);h="dhx_cal_event_line "+(h||""),t._no_drag_move&&(h+=" no_drag_move");var c=t.color?"background:"+t.color+";":"",m=t.textColor?"color:"+t.textColor+";":"",g=e.templates.event_bar_text(t.start_date,t.end_date,t),u="<div "+e._waiAria.eventBarAttrString(t)+" event_id='"+t.id+"' class='"+h+"' style='"+c+m+"position:absolute; top:"+d+"px; height: "+l+"px; left:"+r+"px; width:"+Math.max(0,n-r)+"px;"+(t._text_style||"")+"'>";if(e.config.drag_resize&&!e.config.readonly){var v="<div class='dhx_event_resize dhx_event_resize_start' style='height: "+l+"px;'></div>",f="<div class='dhx_event_resize dhx_event_resize_end' style='height: "+l+"px;'></div>";u+=(t._no_resize_start?"":v)+(t._no_resize_end?"":f)}if(u+=g+"</div>",!_)return u;var x=document.createElement("DIV");x.innerHTML=u;var p=this.order[i],y=e._els.dhx_cal_data[0].firstChild.rows[p];if(y){var w=y.cells[1].firstChild;e._rendered.push(x.firstChild),w.appendChild(x.firstChild)}},e._timeline_trace_events=function(){for(var t,_=e.get_visible_events(),i=[],a=0;a<this.y_unit.length;a++)i[a]=[];i[t]||(i[t]=[]);for(a=0;a<_.length;a++){t=this.order[_[a][this.y_property]];for(var r=0;this._trace_x[r+1]&&_[a].start_date>=this._trace_x[r+1];)r++;for(;this._trace_x[r]&&_[a].end_date>this._trace_x[r];)i[t][r]||(i[t][r]=[]),i[t][r].push(_[a]),r++}return i},e._timeline_getX=function(t,_,i){var a=0,r=i._step,n=i.round_position,s=0,l=_?t.end_date:t.start_date;l.valueOf()>e._max_date.valueOf()&&(l=e._max_date);var d=l-e._min_date_timeline;if(d>0){var o=e._get_date_index(i,l);e._ignores[o]&&(n=!0);for(var h=0;h<o;h++)a+=e._cols[h];var c=e._timeline_get_rounded_date.apply(i,[l,!1]);n?+l>+c&&_&&(s=e._cols[o]):(d=l-c,i.first_hour||i.last_hour?((d-=i._start_correction)<0&&(d=0),(s=Math.round(d/r))>e._cols[o]&&(s=e._cols[o])):s=Math.round(d/r))}return a+=_?0===d||n?s-14:s-12:s+1},e._timeline_get_rounded_date=function(t,_){var i=e._get_date_index(this,t),a=this._trace_x[i];return _&&+t!=+this._trace_x[i]&&(a=this._trace_x[i+1]?this._trace_x[i+1]:e.date.add(this._trace_x[i],this.x_step,this.x_unit)),new Date(a)},e._timeline_skip_ignored=function(t){if(e._ignores_detected)for(var _,i,a,r,n=0;n<t.length;n++){for(r=t[n],a=!1,_=e._get_date_index(this,r.start_date),i=e._get_date_index(this,r.end_date);_<i;){if(!e._ignores[_]){a=!0;break}_++}a||_!=i||e._ignores[i]||+r.end_date>+this._trace_x[i]&&(a=!0),a||(t.splice(n,1),n--)}},e._timeline_get_events_html=function(t){var _="";if(t&&"cell"!=this.render){e._timeline_skip_ignored.call(this,t),t.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var i=[],a=t.length,r=0;r<a;r++){var n=t[r];n._inner=!1;var s=this.round_position?e._timeline_get_rounded_date.apply(this,[n.start_date,!1]):n.start_date;for(this.round_position?e._timeline_get_rounded_date.apply(this,[n.end_date,!0]):n.end_date;i.length;){if(!(i[i.length-1].end_date.valueOf()<=s.valueOf()))break;i.splice(i.length-1,1)}for(var l=!1,d=0;d<i.length;d++){var o=i[d];if(o.end_date.valueOf()<=s.valueOf()){l=!0,n._sorder=o._sorder,i.splice(d,1),n._inner=!0;break}}if(i.length&&(i[i.length-1]._inner=!0),!l)if(i.length)if(i.length<=i[i.length-1]._sorder){if(i[i.length-1]._sorder)for(var h=0;h<i.length;h++){for(var c=!1,m=0;m<i.length;m++)if(i[m]._sorder==h){c=!0;break}if(!c){n._sorder=h;break}}else n._sorder=0;n._inner=!0}else{for(var g=i[0]._sorder,u=1;u<i.length;u++)i[u]._sorder>g&&(g=i[u]._sorder);n._sorder=g+1,n._inner=!1}else n._sorder=0;i.push(n),i.length>(i.max_count||0)?(i.max_count=i.length,n._count=i.length):n._count=n._count?n._count:1}for(var v=0;v<t.length;v++)t[v]._count=i.max_count;for(var f=0;f<a;f++)_+=e.render_timeline_event.call(this,t[f],!1)}return _},e._timeline_y_scale=function(t){var _="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>";e._load_mode&&e._load();for(var i=e._prepare_timeline_events(this),a=0,r=0;r<e._cols.length;r++)a+=e._cols[r];var n=new Date,s=e._cols.length-e._ignores_detected;n=(e.date.add(n,this.x_step*s,this.x_unit)-n-(this._start_correction+this._end_correction)*s)/a,this._step=n,this._summ=a;var l=e._colsS.heights=[],d=[];this._events_height={},this._section_height={};for(r=0;r<this.y_unit.length;r++){var o=this._logic(this.render,this.y_unit[r],this);e._merge(o,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*o.height<t.offsetHeight&&(o.height=Math.max(o.height,Math.floor((t.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[r].key]=o.height),o.td_className||(o.td_className="dhx_matrix_scell"+(e.templates[this.name+"_scaley_class"](this.y_unit[r].key,this.y_unit[r].label,this.y_unit[r])?" "+e.templates[this.name+"_scaley_class"](this.y_unit[r].key,this.y_unit[r].label,this.y_unit[r]):"")),o.td_content||(o.td_content=e.templates[this.name+"_scale_label"](this.y_unit[r].key,this.y_unit[r].label,this.y_unit[r])),e._merge(o,{tr_className:"",style_height:"height:"+o.height+"px;",style_width:"width:"+this.dx+"px;",summ_width:"width:"+a+"px;",table_className:""});var h=e._timeline_get_events_html.call(this,i[r]);if(this.fit_events){var c=this._events_height[this.y_unit[r].key]||0;o.height=c>o.height?c:o.height,o.style_height="height:"+o.height+"px;",this._section_height[this.y_unit[r].key]=o.height}if(_+="<tr class='"+o.tr_className+"' style='"+o.style_height+"'><td class='"+o.td_className+"' style='"+o.style_width+" height:"+(o.height-1)+"px;' "+e._waiAria.label(o.td_content)+">"+o.td_content+"</td>","cell"==this.render)for(var m=0;m<e._cols.length;m++)e._ignores[m]?_+="<td></td>":_+="<td class='dhx_matrix_cell "+e.templates[this.name+"_cell_class"](i[r][m],this._trace_x[m],this.y_unit[r])+"' style='width:"+e._cols[m]+"px'><div style='width:auto'>"+e.templates[this.name+"_cell_value"](i[r][m],this._trace_x[m],this.y_unit[r])+"</div></td>";else{_+="<td><div style='"+o.summ_width+" "+o.style_height+" position:relative;' class='dhx_matrix_line'>",_+=h,_+="<table class='"+o.table_className+"' cellpadding='0' cellspacing='0' style='"+o.summ_width+" "+o.style_height+"' >";for(m=0;m<e._cols.length;m++)e._ignores[m]?_+="<td></td>":_+="<td class='dhx_matrix_cell "+e.templates[this.name+"_cell_class"](i[r],this._trace_x[m],this.y_unit[r])+"' style='width:"+e._cols[m]+"px'></td>";_+="</table>",_+="</div></td>"}_+="</tr>",d.push(o)}_+="</table>",this._matrix=i,t.innerHTML=_,e._populate_timeline_rendered(t),this._scales={};for(var g=t.firstChild.rows,u=null,v=(r=0,d.length);r<v;r++){u=this.y_unit[r],l.push(d[r].height);var f=u.key,x=this._scales[f]=e._isRender("cell")?g[r]:g[r].childNodes[1].getElementsByTagName("div")[0];e.callEvent("onScaleAdd",[x,f])}},e._timeline_x_dates=function(t){var _=e._min_date,i=e._max_date;e._process_ignores(_,this.x_size,this.x_unit,this.x_step,t);this.x_size,t&&e._ignores_detected;for(var a=0,r=0;+_<+i;)if(this._trace_x[r]=new Date(_),"month"==this.x_unit&&e.date[this.x_unit+"_start"]&&(_=e.date[this.x_unit+"_start"](new Date(_))),_=e.date.add(_,this.x_step,this.x_unit),e.date[this.x_unit+"_start"]&&(_=e.date[this.x_unit+"_start"](_)),e._ignores[r]||a++,r++,t)if(a<this.x_size&&!(+_<+i))i=e.date["add_"+this.name+"_private"](i,(this.x_length||this.x_size)*this.x_step);else if(a>=this.x_size){e._max_date=_;break}return{total:r,displayed:a}},e._timeline_x_scale=function(t){var _=e.xy.scale_height,i=this._header_resized||e.xy.scale_height;e._cols=[],e._colsS={height:0},this._trace_x=[];var a=e._x-this.dx-e.xy.scroll_width,r=[this.dx];e._els.dhx_cal_header[0].style.width=r[0]+a+"px";for(var n=e._min_date_timeline=e._min_date,s=e.config.preserve_scale_length,l=e._timeline_x_dates.call(this,s),d=l.displayed,o=l.total,h=0;h<o;h++)e._ignores[h]?(e._cols[h]=0,d++):e._cols[h]=Math.floor(a/(d-h)),a-=e._cols[h],r[h+1]=r[h]+e._cols[h];if(t.innerHTML="<div></div>",this.second_scale){for(var c=this.second_scale.x_unit,m=[this._trace_x[0]],g=[],u=[this.dx,this.dx],v=0,f=0;f<this._trace_x.length;f++){var x=this._trace_x[f];e._timeline_is_new_interval(c,x,m[v])&&(m[++v]=x,u[v+1]=u[v]);var p=v+1;g[v]=e._cols[f]+(g[v]||0),u[p]+=e._cols[f]}t.innerHTML="<div></div><div></div>";var y=t.firstChild;y.style.height=i+"px",t.lastChild.style.position="relative";for(var w=0;w<m.length;w++){var k=m[w],b=e.templates[this.name+"_second_scalex_class"](k),D=document.createElement("DIV");D.className="dhx_scale_bar dhx_second_scale_bar"+(b?" "+b:""),e.set_xy(D,g[w]-1,i-3,u[w],0),D.innerHTML=e.templates[this.name+"_second_scale_date"](k),y.appendChild(D)}}e.xy.scale_height=i,t=t.lastChild;for(var z=0;z<this._trace_x.length;z++)if(!e._ignores[z]){n=this._trace_x[z],e._render_x_header(z,r[z],n,t);var E=e.templates[this.name+"_scalex_class"](n);E&&(t.lastChild.className+=" "+E)}e.xy.scale_height=_;var T=this._trace_x;t.onclick=function(t){var _=e._timeline_locate_hcell(t);_&&e.callEvent("onXScaleClick",[_.x,T[_.x],t||event])},t.ondblclick=function(t){var _=e._timeline_locate_hcell(t);_&&e.callEvent("onXScaleDblClick",[_.x,T[_.x],t||event])}},e._timeline_is_new_interval=function(t,_,i){switch(t){case"hour":return _.getHours()!=i.getHours()||e._timeline_is_new_interval("day",_,i);case"day":return!(_.getDate()==i.getDate()&&_.getMonth()==i.getMonth()&&_.getFullYear()==i.getFullYear());case"week":return!(e.date.week_start(new Date(_)).valueOf()==e.date.week_start(new Date(i)).valueOf());case"month":return!(_.getMonth()==i.getMonth()&&_.getFullYear()==i.getFullYear());case"year":return!(_.getFullYear()==i.getFullYear());default:return!1}},e._timeline_reset_scale_height=function(t){if(this._header_resized&&(!t||!this.second_scale)){e.xy.scale_height/=2,this._header_resized=!1;var _=e._els.dhx_cal_header[0];_.className=_.className.replace(/ dhx_second_cal_header/gi,"")}},e._timeline_set_full_view=function(t){if(e._timeline_reset_scale_height.call(this,t),t){this.second_scale&&!this._header_resized&&(this._header_resized=e.xy.scale_height,e.xy.scale_height*=2,e._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),e.set_sizes(),e._init_matrix_tooltip();var _=e._min_date;e._timeline_x_scale.call(this,e._els.dhx_cal_header[0]),e._timeline_y_scale.call(this,e._els.dhx_cal_data[0]),e._min_date=_,e._els.dhx_cal_date[0].innerHTML=e.templates[this.name+"_date"](e._min_date,e._max_date),e._mark_now&&e._mark_now(),e._timeline_reset_scale_height.call(this,t)}e._timeline_hideToolTip()},e._timeline_hideToolTip=function(){e._tooltip&&(e._tooltip.style.display="none",e._tooltip.date="")},e._timeline_showToolTip=function(t,_,i){if("cell"==t.render){var a=_.x+"_"+_.y,r=t._matrix[_.y][_.x];if(!r)return e._timeline_hideToolTip();if(r.sort(function(e,t){return e.start_date>t.start_date?1:-1}),e._tooltip){if(e._tooltip.date==a)return;e._tooltip.innerHTML=""}else{var n=e._tooltip=document.createElement("DIV");n.className="dhx_year_tooltip",document.body.appendChild(n),n.onclick=e._click.dhx_cal_data}for(var s="",l=0;l<r.length;l++){var d=r[l].color?"background-color:"+r[l].color+";":"",o=r[l].textColor?"color:"+r[l].textColor+";":"";s+="<div class='dhx_tooltip_line' event_id='"+r[l].id+"' style='"+d+o+"'>",s+="<div class='dhx_tooltip_date'>"+(r[l]._timed?e.templates.event_date(r[l].start_date):"")+"</div>",s+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",s+=e.templates[t.name+"_tooltip"](r[l].start_date,r[l].end_date,r[l])+"</div>"}e._tooltip.style.display="",e._tooltip.style.top="0px",document.body.offsetWidth-i.left-e._tooltip.offsetWidth<0?e._tooltip.style.left=i.left-e._tooltip.offsetWidth+"px":e._tooltip.style.left=i.left+_.src.offsetWidth+"px",e._tooltip.date=a,e._tooltip.innerHTML=s,document.body.offsetHeight-i.top-e._tooltip.offsetHeight<0?e._tooltip.style.top=i.top-e._tooltip.offsetHeight+_.src.offsetHeight+"px":e._tooltip.style.top=i.top+"px"}},e._matrix_tooltip_handler=function(t){var _=e.matrix[e._mode];if(_&&"cell"==_.render){if(_){var i=e._locate_cell_timeline(t);(t=t||event).target||t.srcElement;if(i)return e._timeline_showToolTip(_,i,getOffset(i.src))}e._timeline_hideToolTip()}},e._init_matrix_tooltip=function(){e._detachDomEvent(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler),dhtmlxEvent(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler)},e._set_timeline_dates=function(t){e._min_date=e.date[t.name+"_start"](new Date(e._date)),e._max_date=e.date["add_"+t.name+"_private"](e._min_date,t.x_size*t.x_step),e.date[t.x_unit+"_start"]&&(e._max_date=e.date[t.x_unit+"_start"](e._max_date)),e._table_view=!0},e._renderMatrix=function(t,_){_||(e._els.dhx_cal_data[0].scrollTop=0),e._set_timeline_dates(this),e._timeline_set_full_view.call(this,t)},e._timeline_html_index=function(t){for(var _=t.parentNode.childNodes,i=-1,a=0;a<_.length;a++)if(_[a]==t){i=a;break}var r=i;if(e._ignores_detected)for(var n in e._ignores)e._ignores[n]&&1*n<=r&&r++;return r},e._timeline_locate_hcell=function(t){for(var _=(t=t||event).target?t.target:t.srcElement;_&&"DIV"!=_.tagName;)_=_.parentNode;if(_&&"DIV"==_.tagName&&"dhx_scale_bar"==e._getClassName(_).split(" ")[0])return{x:e._timeline_html_index(_),y:-1,src:_,scale:!0}},e._locate_cell_timeline=function(t){for(var _=(t=t||event).target?t.target:t.srcElement,i={},a=e.matrix[e._mode],r=e.getActionData(t),n=e._ignores,s=0,l=0;l<a._trace_x.length-1&&!(+r.date<a._trace_x[l+1]);l++)n[l]||s++;i.x=0===s?0:l,i.y=a.order[r.section];var d=e._isRender("cell")?1:0;i.src=a._scales[r.section]?a._scales[r.section].getElementsByTagName("td")[l+d]:null;for(var o=!1;0===i.x&&"dhx_cal_data"!=e._getClassName(_)&&_.parentNode;){if("dhx_matrix_scell"==e._getClassName(_).split(" ")[0]){o=!0;break}_=_.parentNode}return o?(i.x=-1,i.src=_,i.scale=!0):i.x=l,i};var t=e._click.dhx_cal_data;e._click.dhx_marked_timespan=e._click.dhx_cal_data=function(_){var i=t.apply(this,arguments),a=e.matrix[e._mode];if(a){var r=e._locate_cell_timeline(_);r&&(r.scale?e.callEvent("onYScaleClick",[r.y,a.y_unit[r.y],_||event]):e.callEvent("onCellClick",[r.x,r.y,a._trace_x[r.x],(a._matrix[r.y]||{})[r.x]||[],_||event]))}return i},e.dblclick_dhx_matrix_cell=function(t){var _=e.matrix[e._mode];if(_){var i=e._locate_cell_timeline(t);i&&(i.scale?e.callEvent("onYScaleDblClick",[i.y,_.y_unit[i.y],t||event]):e.callEvent("onCellDblClick",[i.x,i.y,_._trace_x[i.x],(_._matrix[i.y]||{})[i.x]||[],t||event]))}};var _=e.dblclick_dhx_marked_timespan||function(){};e.dblclick_dhx_marked_timespan=function(t){return e.matrix[e._mode]?e.dblclick_dhx_matrix_cell(t):_.apply(this,arguments)},e.dblclick_dhx_matrix_scell=function(t){return e.dblclick_dhx_matrix_cell(t)},e._isRender=function(t){return e.matrix[e._mode]&&e.matrix[e._mode].render==t},e.attachEvent("onCellDblClick",function(t,_,i,a,r){if(!this.config.readonly&&("dblclick"!=r.type||this.config.dblclick_create)){var n=e.matrix[e._mode],s={};s.start_date=n._trace_x[t],s.end_date=n._trace_x[t+1]?n._trace_x[t+1]:e.date.add(n._trace_x[t],n.x_step,n.x_unit),n._start_correction&&(s.start_date=new Date(1*s.start_date+n._start_correction)),n._end_correction&&(s.end_date=new Date(s.end_date-n._end_correction)),s[n.y_property]=n.y_unit[_].key,e.addEventNow(s,null,r)}}),e.attachEvent("onBeforeDrag",function(t,_,i){return!e._isRender("cell")}),e.attachEvent("onEventChanged",function(e,t){t._timed=this.isOneDayEvent(t)}),e.attachEvent("onBeforeEventChanged",function(e,t,_,i){return e&&(e._move_delta=void 0),i&&(i._move_delta=void 0),!0}),e._is_column_visible=function(t){var _=e.matrix[e._mode],i=e._get_date_index(_,t);return!e._ignores[i]};var i=e._render_marked_timespan;e._render_marked_timespan=function(t,_,a,r,n){if(!e.config.display_marked_timespans)return[];if(e.matrix&&e.matrix[e._mode]){if(e._isRender("cell"))return;var s=e._lame_copy({},e.matrix[e._mode]);s.round_position=!1;var l=[],d=[],o=[],h=t.sections?t.sections.units||t.sections.timeline:null;if(a)o=[_],d=[a];else{var c=s.order;if(h)c.hasOwnProperty(h)&&(d.push(h),o.push(s._scales[h]));else if(s._scales)for(var m in c)c.hasOwnProperty(m)&&(d.push(m),o.push(s._scales[m]))}r=r?new Date(r):e._min_date,n=n?new Date(n):e._max_date;if(r.valueOf()<e._min_date.valueOf()&&(r=new Date(e._min_date)),n.valueOf()>e._max_date.valueOf()&&(n=new Date(e._max_date)),!s._trace_x)return;for(var g=0;g<s._trace_x.length&&!e._is_column_visible(s._trace_x[g]);g++);if(g==s._trace_x.length)return;var u=[];if(t.days>6){var v=new Date(t.days);e.date.date_part(new Date(r))<=+v&&+n>=+v&&u.push(v)}else u.push.apply(u,e._get_dates_by_index(t.days));for(var f=t.zones,x=e._get_css_classes_by_config(t),p=0;p<d.length;p++){_=o[p],a=d[p];for(g=0;g<u.length;g++)for(var y=u[g],w=0;w<f.length;w+=2){var k=f[w],b=f[w+1],D=new Date(+y+60*k*1e3),z=new Date(+y+60*b*1e3);if(D=new Date(D.valueOf()+1e3*(D.getTimezoneOffset()-y.getTimezoneOffset())*60),r<(z=new Date(z.valueOf()+1e3*(z.getTimezoneOffset()-y.getTimezoneOffset())*60))&&n>D){var E=e._get_block_by_config(t);E.className=x;var T=e._timeline_getX({start_date:D},!1,s)-1,C=e._timeline_getX({start_date:z},!1,s)-1,O=Math.max(1,C-T-1),N=s._section_height[a]-1||s.dy-1;E.style.cssText="height: "+N+"px; left: "+T+"px; width: "+O+"px; top: 0;",_.insertBefore(E,_.firstChild),l.push(E)}}}return l}return i.apply(e,[t,_,a])};var a=e._append_mark_now;e._append_mark_now=function(t,_){if(e.matrix&&e.matrix[e._mode]){var i=e._currentDate(),r=e._get_zone_minutes(i),n={days:+e.date.date_part(i),zones:[r,r+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return e._render_marked_timespan(n)}return a.apply(e,[t,_])};var r=e._mark_timespans;e._mark_timespans=function(){if(e.matrix&&e.matrix[e.getState().mode]){for(var t=[],_=e.matrix[e.getState().mode],i=_.y_unit,a=0;a<i.length;a++){var n=i[a].key,s=_._scales[n],l=e._on_scale_add_marker(s,n);t.push.apply(t,l)}return t}return r.apply(this,arguments)};var n=e._on_scale_add_marker;e._on_scale_add_marker=function(t,_){if(e.matrix&&e.matrix[e._mode]){var i=[],a=e._marked_timespans;if(a&&e.matrix&&e.matrix[e._mode])for(var r=e._mode,s=e._min_date,l=e._max_date,d=a.global,o=e.date.date_part(new Date(s));o<l;o=e.date.add(o,1,"day")){var h=+o,c=o.getDay(),m=[],g=d[h]||d[c];if(m.push.apply(m,e._get_configs_to_render(g)),a[r]&&a[r][_]){var u=[],v=e._get_types_to_render(a[r][_][c],a[r][_][h]);u.push.apply(u,e._get_configs_to_render(v)),u.length&&(m=u)}for(var f=0;f<m.length;f++){var x=m[f],p=x.days;p<7?(p=h,i.push.apply(i,e._render_marked_timespan(x,t,_,o,e.date.add(o,1,"day"))),p=c):i.push.apply(i,e._render_marked_timespan(x,t,_,o,e.date.add(o,1,"day")))}}return i}return n.apply(this,arguments)},e._resolve_timeline_section=function(e,t){for(var _=0,i=0;_<this._colsS.heights.length&&!((i+=this._colsS.heights[_])>t.y);_++);e.y_unit[_]||(_=e.y_unit.length-1),this._drag_event&&!this._drag_event._orig_section&&(this._drag_event._orig_section=e.y_unit[_].key),t.fields={},_>=0&&e.y_unit[_]&&(t.section=t.fields[e.y_property]=e.y_unit[_].key)},e._update_timeline_section=function(e){var t=e.view,_=e.event,i=e.pos;if(_){if(_[t.y_property]!=i.section){var a=this._get_timeline_event_height(_,t);_._sorder=this._get_dnd_order(_._sorder,a,t._section_height[i.section])}_[t.y_property]=i.section}},e._get_date_index=function(e,t){for(var _=0,i=e._trace_x;_<i.length-1&&+t>=+i[_+1];)_++;return _},e._timeline_drag_date=function(t,_){for(var i,a,r,n=t,s=_,l=0,d=0;d<=this._cols.length-1;d++)if((l+=a=this._cols[d])>s){i=(i=(s-(l-a))/a)<0?0:i;break}if(n.round_position){var o=1,h=e.getState().drag_mode;h&&"move"!=h&&"create"!=h&&(o=.5),i>=o&&d++,i=0}if(0===d&&this._ignores[0])for(d=1,i=0;this._ignores[d];)d++;else if(d==this._cols.length&&this._ignores[d-1]){for(d=this._cols.length-1,i=0;this._ignores[d];)d--;d++}if(d>=n._trace_x.length)r=e.date.add(n._trace_x[n._trace_x.length-1],n.x_step,n.x_unit),n._end_correction&&(r=new Date(r-n._end_correction));else{var c=i*a*n._step+n._start_correction;r=new Date(+n._trace_x[d]+c)}return r},e.attachEvent("onBeforeTodayDisplayed",function(){for(var t in e.matrix){var _=e.matrix[t];_.x_start=_._original_x_start}return!0}),e.attachEvent("onOptionsLoad",function(){for(var t in e.matrix){var _=e.matrix[t];_.order={},e.callEvent("onOptionsLoadStart",[]);for(t=0;t<_.y_unit.length;t++)_.order[_.y_unit[t].key]=t;e.callEvent("onOptionsLoadFinal",[]),e._date&&_.name==e._mode&&e.setCurrentView(e._date,e._mode)}}),e.attachEvent("onSchedulerResize",function(){if(e.matrix[this._mode]){var t=e.matrix[this._mode];return e._renderMatrix.call(t,!0,!0),!1}return!0}),e.attachEvent("onBeforeDrag",function(t,_,i){if("resize"==_){var a=i.target||i.srcElement;e._getClassName(a).indexOf("dhx_event_resize_end")<0?e._drag_from_start=!0:e._drag_from_start=!1}return!0})},e._temp_matrix_scope()});